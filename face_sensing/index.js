!async function(){await Scratch.require("https://unpkg.com/@mediapipe/face_detection@0.4.1646425229/face_detection.js"),await Scratch.require("https://unpkg.com/@tensorflow/tfjs-core@4.4.0/dist/tf-core.min.js"),await Scratch.require("https://unpkg.com/@tensorflow/tfjs-backend-webgl@4.4.0/dist/tf-backend-webgl.min.js"),await Scratch.require("https://unpkg.com/@tensorflow-models/face-detection@1.0.1/dist/face-detection.min.js");const e=Scratch.ArgumentType,t=Scratch.BlockType,M=Scratch.Clone,i=Scratch.MathUtil,D=Scratch.formatMessage,a=Scratch.TargetType;Scratch.extensions.register(new class c{static get INTERVAL(){return 1e3/15}static get DIMENSIONS(){return[480,360]}static get STATE_KEY(){return"Scratch.faceSensing"}static get DEFAULT_FACE_SENSING_STATE(){return{attachedToPartNumber:null,prevX:0,offsetX:0,prevY:0,offsetY:0,prevSize:100,offsetSize:0,prevDirection:0,offsetDirection:0}}constructor(){this.runtime=Scratch.vm.runtime,this.runtime.emit("EXTENSION_DATA_LOADING",!0);var e=window.faceDetection.SupportedModels.MediaPipeFaceDetector;faceDetection.createDetector(e,{runtime:"mediapipe",solutionPath:"https://unpkg.com/@mediapipe/face_detection@0.4.1646425229/"}).then(e=>{this.detector=e,this.runtime.ioDevices&&this._loop()}),this.cachedSize=100,this.cachedTilt=90,this.isDetectedArrayLength=5,this.isDetectedArray=new Array(this.isDetectedArrayLength),this.isDetectedArray.fill(!1,0,this.isDetectedArrayLength),this.smoothedIsDetected=!1,this._clearAttachments=this._clearAttachments.bind(this),this.runtime.on("PROJECT_STOP_ALL",this._clearAttachments)}reset(){}_loop(){setTimeout(this._loop.bind(this),Math.max(this.runtime.currentStepTime,c.INTERVAL));var e=this.runtime.ioDevices.video.getFrame({format:"image-data",dimensions:c.DIMENSIONS,cacheTimeout:this.runtime.currentStepTime});e&&this.detector.estimateFaces(e,!1).then(e=>{e&&(this.firstTime||(this.firstTime=!0,this.runtime.emit("EXTENSION_DATA_LOADING",!1)),this.currentFace=e[0],this.updateIsDetected())})}updateIsDetected(){this.isDetectedArray.push(!!this.currentFace),this.isDetectedArray.length>this.isDetectedArrayLength&&this.isDetectedArray.shift(),this.isDetectedArray.every(e=>!1===e)&&(this.smoothedIsDetected=!1),this.isDetectedArray.every(e=>!0===e)&&(this.smoothedIsDetected=!0)}_getFaceSensingState(e){let t=e.getCustomState(c.STATE_KEY);return t||(t=M.simple(c.DEFAULT_FACE_SENSING_STATE),e.setCustomState(c.STATE_KEY,t)),t}getInfo(){return this.runtime.ioDevices.video.enableVideo(),{id:"faceSensing",name:D({id:"faceSensing.categoryName",default:"Face Sensing",description:"Name of face sensing extension"}),blockIconURI:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3R5bGU9ImJhY2tncm91bmQ6IzBmYmQ4YyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBmaWxsPSIjMEZCRDhDIiBkPSJNMCAwaDQwdjQwSDB6Ii8+PGNpcmNsZSBmaWxsPSIjRkZGIiBjeD0iMTUuNSIgY3k9IjE3LjUiIHI9IjEuNSIvPjxjaXJjbGUgZmlsbD0iI0ZGRiIgY3g9IjI0LjUiIGN5PSIxNy41IiByPSIxLjUiLz48cGF0aCBkPSJNMjAgOUMxMy45MjUgOSA5IDEzLjkyNSA5IDIwczQuOTI1IDExIDExIDExIDExLTQuOTI1IDExLTExUzI2LjA3NSA5IDIwIDl6bTAgMmE5IDkgMCAxMTAgMTggOSA5IDAgMDEwLTE4eiIgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTM1IDRhMSAxIDAgMDEuOTkzLjg4M0wzNiA1djZhMSAxIDAgMDEtMS45OTMuMTE3TDM0IDExVjZoLTVhMSAxIDAgMDEtLjk5My0uODgzTDI4IDVhMSAxIDAgMDEuODgzLS45OTNMMjkgNGg2ek01IDM2YTEgMSAwIDAxLS45OTMtLjg4M0w0IDM1di02YTEgMSAwIDAxMS45OTMtLjExN0w2IDI5djVoNWExIDEgMCAwMS45OTMuODgzTDEyIDM1YTEgMSAwIDAxLS44ODMuOTkzTDExIDM2SDV6IiBmaWxsLW9wYWNpdHk9Ii4yNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTI5LjcyIDI0LjAyOGEyLjU1NyAyLjU1NyAwIDAwMS44MDgtMS44MDhsLjU0NC0yLjAwOWMuMjUyLS45NDggMS42LS45NDggMS44NTYgMGwuNTQgMi4wMDlhMi41NjMgMi41NjMgMCAwMDEuODEzIDEuODA4bDIuMDA4LjU0NGMuOTQ4LjI1Mi45NDggMS42IDAgMS44NTdsLTIuMDA4LjU0YTIuNTYzIDIuNTYzIDAgMDAtMS44MTMgMS44MDhsLS41NCAyLjAwOWMtLjI1Ni45NTItMS42MDQuOTUyLTEuODU2IDBsLS41NDQtMi4wMDlhMi41NTcgMi41NTcgMCAwMC0xLjgwOS0xLjgwOGwtMi4wMDgtLjU0Yy0uOTQ4LS4yNTYtLjk0OC0xLjYwNSAwLTEuODU3bDIuMDA4LS41NDR6TTUuMDQgNi4zOTZBMS45MTggMS45MTggMCAwMDYuMzk2IDUuMDRsLjQwOC0xLjUwN2MuMTg5LS43MSAxLjItLjcxIDEuMzkyIDBsLjQwNSAxLjUwN2ExLjkyMiAxLjkyMiAwIDAwMS4zNiAxLjM1NmwxLjUwNi40MDhjLjcxLjE5LjcxIDEuMiAwIDEuMzkzbC0xLjUwNy40MDVhMS45MjIgMS45MjIgMCAwMC0xLjM1OSAxLjM1NmwtLjQwNSAxLjUwNmMtLjE5Mi43MTUtMS4yMDMuNzE1LTEuMzkyIDBsLS40MDgtMS41MDZBMS45MTggMS45MTggMCAwMDUuMDQgOC42MDJsLTEuNTA3LS40MDVjLS43MS0uMTkyLS43MS0xLjIwNCAwLTEuMzkzbDEuNTA3LS40MDh6IiBmaWxsPSIjRkZCRjAwIi8+PHBhdGggZD0iTTIyLjE2OCAyMS45NDVhMSAxIDAgMTExLjY2NCAxLjExQzIyLjk3NCAyNC4zNDIgMjEuNjU4IDI1IDIwIDI1cy0yLjk3NC0uNjU4LTMuODMyLTEuOTQ1YTEgMSAwIDExMS42NjQtMS4xMUMxOC4zMDcgMjIuNjU4IDE4Ljk5MiAyMyAyMCAyM2MxLjAwOSAwIDEuNjkzLS4zNDIgMi4xNjgtMS4wNTV6IiBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNMzEuNTg5IDIwLjA4M2wtLjU0NCAyLjAwNmEyLjA1OCAyLjA1OCAwIDAxLTEuNDU3IDEuNDU3bC0yLjAwOC41NDRjLTEuNDQuMzgzLTEuNDQgMi40MzIgMCAyLjgyMWwyLjAxLjU0Yy43MS4xOSAxLjI2NC43NDYgMS40NTUgMS40NTZsLjU0NCAyLjAxYy4zODMgMS40NDUgMi40MzMgMS40NDUgMi44MjItLjAwMWwuNTQtMi4wMDlhMi4wNjMgMi4wNjMgMCAwMTEuNDU5LTEuNDU1bDIuMDA5LS41NGMxLjQ0Mi0uMzkgMS40NDItMi40NC0uMDAyLTIuODIzbC0yLjAwNi0uNTQzYTIuMDYyIDIuMDYyIDAgMDEtMS40Ni0xLjQ1NWwtLjU0LTIuMDFjLS4zOS0xLjQ0Mi0yLjQzOS0xLjQ0Mi0yLjgyMi4wMDJ6bTEuODU2LjI1OWwuNTQgMi4wMDhhMy4wNjIgMy4wNjIgMCAwMDIuMTY1IDIuMTZsMi4wMDguNTQ1Yy40NTYuMTIuNDU2Ljc2OCAwIC44OTFsLTIuMDA3LjU0YTMuMDYyIDMuMDYyIDAgMDAtMi4xNjYgMi4xNjJsLS41NCAyLjAwOGMtLjEyMy40NTgtLjc2OS40NTgtLjg5LjAwMmwtLjU0NS0yLjAxMWEzLjA1NyAzLjA1NyAwIDAwLTIuMTYyLTIuMTYxbC0yLjAwNy0uNTRjLS40NTUtLjEyMy0uNDU1LS43Ny0uMDAxLS44OWwyLjAxLS41NDVhMy4wNTcgMy4wNTcgMCAwMDIuMTYtMi4xNjJsLjU0NC0yLjAwN2MuMTIyLS40NTYuNzY5LS40NTYuODkxIDB6IiBmaWxsLW9wYWNpdHk9Ii41IiBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNi4zMiAzLjQwNWwtLjQwNyAxLjUwNGMtLjEzLjQ5LS41MTEuODctMS4wMDQgMS4wMDVsLTEuNTA2LjQwOGMtMS4yMDQuMzItMS4yMDQgMi4wMzIgMCAyLjM1N2wxLjUwNy40MDVjLjQ5LjEzMS44NzIuNTE0IDEuMDAzIDEuMDAzbC40MDggMS41MDhjLjMyIDEuMjA3IDIuMDMzIDEuMjA3IDIuMzU4IDBsLjQwNS0xLjUwN2ExLjQyMiAxLjQyMiAwIDAxMS4wMDUtMS4wMDNsMS41MDgtLjQwNmMxLjIwNC0uMzI1IDEuMjA0LTIuMDM3LS4wMDItMi4zNThsLTEuNTA0LS40MDhhMS40MjIgMS40MjIgMCAwMS0xLjAwNy0xLjAwMkw4LjY4IDMuNDAzYy0uMzI1LTEuMjA0LTIuMDM4LTEuMjA0LTIuMzU4LjAwMnptMS4zOTMuMjU5bC40MDUgMS41MDZBMi40MjEgMi40MjEgMCAwMDkuODMgNi44NzlsMS41MDcuNDA4Yy4yMTguMDU4LjIxOC4zNjggMCAuNDI3bC0xLjUwNS40MDVhMi40MjIgMi40MjIgMCAwMC0xLjcxMyAxLjcxbC0uNDA1IDEuNTA2Yy0uMDU5LjIyLS4zNjguMjItLjQyNi4wMDFsLS40MDktMS41MDlhMi40MTcgMi40MTcgMCAwMC0xLjcxLTEuNzA4bC0xLjUwNS0uNDA1Yy0uMjE3LS4wNTktLjIxNy0uMzctLjAwMS0uNDI3TDUuMTcgNi44OGEyLjQxOCAyLjQxOCAwIDAwMS43MDktMS43MWwuNDA3LTEuNTA1Yy4wNTktLjIxOC4zNjktLjIxOC40MjcgMHoiIGZpbGwtb3BhY2l0eT0iLjQiIGZpbGw9IiMwMDAiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=",menuIconURI:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0Qzk3RkYiIGN4PSIxNS41IiBjeT0iMTcuNSIgcj0iMS41Ii8+PGNpcmNsZSBmaWxsPSIjNEM5N0ZGIiBjeD0iMjQuNSIgY3k9IjE3LjUiIHI9IjEuNSIvPjxwYXRoIGQ9Ik0yMCA5QzEzLjkyNSA5IDkgMTMuOTI1IDkgMjBzNC45MjUgMTEgMTEgMTEgMTEtNC45MjUgMTEtMTFTMjYuMDc1IDkgMjAgOXptMCAyYTkgOSAwIDExMCAxOCA5IDkgMCAwMTAtMTh6IiBmaWxsPSIjNEM5N0ZGIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNMzUgNGExIDEgMCAwMS45OTMuODgzTDM2IDV2NmExIDEgMCAwMS0xLjk5My4xMTdMMzQgMTFWNmgtNWExIDEgMCAwMS0uOTkzLS44ODNMMjggNWExIDEgMCAwMS44ODMtLjk5M0wyOSA0aDZ6TTUgMzZhMSAxIDAgMDEtLjk5My0uODgzTDQgMzV2LTZhMSAxIDAgMDExLjk5My0uMTE3TDYgMjl2NWg1YTEgMSAwIDAxLjk5My44ODNMMTIgMzVhMSAxIDAgMDEtLjg4My45OTNMMTEgMzZINXoiIGZpbGwtb3BhY2l0eT0iLjUiIGZpbGw9IiM0RDk3RkYiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik0yMi4xNjggMjEuOTQ1YTEgMSAwIDExMS42NjQgMS4xMUMyMi45NzQgMjQuMzQyIDIxLjY1OCAyNSAyMCAyNXMtMi45NzQtLjY1OC0zLjgzMi0xLjk0NWExIDEgMCAxMTEuNjY0LTEuMTFDMTguMzA3IDIyLjY1OCAxOC45OTIgMjMgMjAgMjNjMS4wMDkgMCAxLjY5My0uMzQyIDIuMTY4LTEuMDU1eiIgZmlsbD0iIzRDOTdGRiIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTI5LjcyIDI0LjAyOGEyLjU1NyAyLjU1NyAwIDAwMS44MDgtMS44MDhsLjU0NC0yLjAwOWMuMjUyLS45NDggMS42LS45NDggMS44NTYgMGwuNTQgMi4wMDlhMi41NjMgMi41NjMgMCAwMDEuODEzIDEuODA4bDIuMDA4LjU0NGMuOTQ4LjI1Mi45NDggMS42IDAgMS44NTdsLTIuMDA4LjU0YTIuNTYzIDIuNTYzIDAgMDAtMS44MTMgMS44MDhsLS41NCAyLjAwOWMtLjI1Ni45NTItMS42MDQuOTUyLTEuODU2IDBsLS41NDQtMi4wMDlhMi41NTcgMi41NTcgMCAwMC0xLjgwOS0xLjgwOGwtMi4wMDgtLjU0Yy0uOTQ4LS4yNTYtLjk0OC0xLjYwNSAwLTEuODU3bDIuMDA4LS41NDR6TTUuMDQgNi4zOTZBMS45MTggMS45MTggMCAwMDYuMzk2IDUuMDRsLjQwOC0xLjUwN2MuMTg5LS43MSAxLjItLjcxIDEuMzkyIDBsLjQwNSAxLjUwN2ExLjkyMiAxLjkyMiAwIDAwMS4zNiAxLjM1NmwxLjUwNi40MDhjLjcxLjE5LjcxIDEuMiAwIDEuMzkzbC0xLjUwNy40MDVhMS45MjIgMS45MjIgMCAwMC0xLjM1OSAxLjM1NmwtLjQwNSAxLjUwNmMtLjE5Mi43MTUtMS4yMDMuNzE1LTEuMzkyIDBsLS40MDgtMS41MDZBMS45MTggMS45MTggMCAwMDUuMDQgOC42MDJsLTEuNTA3LS40MDVjLS43MS0uMTkyLS43MS0xLjIwNCAwLTEuMzkzbDEuNTA3LS40MDh6IiBmaWxsPSIjRkZCRjAwIi8+PHBhdGggZD0iTTMxLjU4OSAyMC4wODNsLS41NDQgMi4wMDZhMi4wNTggMi4wNTggMCAwMS0xLjQ1NyAxLjQ1N2wtMi4wMDguNTQ0Yy0xLjQ0LjM4My0xLjQ0IDIuNDMyIDAgMi44MjFsMi4wMS41NGMuNzEuMTkgMS4yNjQuNzQ2IDEuNDU1IDEuNDU2bC41NDQgMi4wMWMuMzgzIDEuNDQ1IDIuNDMzIDEuNDQ1IDIuODIyLS4wMDFsLjU0LTIuMDA5YTIuMDYzIDIuMDYzIDAgMDExLjQ1OS0xLjQ1NWwyLjAwOS0uNTRjMS40NDItLjM5IDEuNDQyLTIuNDQtLjAwMi0yLjgyM2wtMi4wMDYtLjU0M2EyLjA2MiAyLjA2MiAwIDAxLTEuNDYtMS40NTVsLS41NC0yLjAxYy0uMzktMS40NDItMi40MzktMS40NDItMi44MjIuMDAyem0xLjg1Ni4yNTlsLjU0IDIuMDA4YTMuMDYyIDMuMDYyIDAgMDAyLjE2NSAyLjE2bDIuMDA4LjU0NWMuNDU2LjEyLjQ1Ni43NjggMCAuODkxbC0yLjAwNy41NGEzLjA2MiAzLjA2MiAwIDAwLTIuMTY2IDIuMTYybC0uNTQgMi4wMDhjLS4xMjMuNDU4LS43NjkuNDU4LS44OS4wMDJsLS41NDUtMi4wMTFhMy4wNTcgMy4wNTcgMCAwMC0yLjE2Mi0yLjE2MWwtMi4wMDctLjU0Yy0uNDU1LS4xMjMtLjQ1NS0uNzctLjAwMS0uODlsMi4wMS0uNTQ1YTMuMDU3IDMuMDU3IDAgMDAyLjE2LTIuMTYybC41NDQtMi4wMDdjLjEyMi0uNDU2Ljc2OS0uNDU2Ljg5MSAweiIgZmlsbC1vcGFjaXR5PSIuNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTYuMzIgMy40MDVsLS40MDcgMS41MDRjLS4xMy40OS0uNTExLjg3LTEuMDA0IDEuMDA1bC0xLjUwNi40MDhjLTEuMjA0LjMyLTEuMjA0IDIuMDMyIDAgMi4zNTdsMS41MDcuNDA1Yy40OS4xMzEuODcyLjUxNCAxLjAwMyAxLjAwM2wuNDA4IDEuNTA4Yy4zMiAxLjIwNyAyLjAzMyAxLjIwNyAyLjM1OCAwbC40MDUtMS41MDdhMS40MjIgMS40MjIgMCAwMTEuMDA1LTEuMDAzbDEuNTA4LS40MDZjMS4yMDQtLjMyNSAxLjIwNC0yLjAzNy0uMDAyLTIuMzU4bC0xLjUwNC0uNDA4YTEuNDIyIDEuNDIyIDAgMDEtMS4wMDctMS4wMDJMOC42OCAzLjQwM2MtLjMyNS0xLjIwNC0yLjAzOC0xLjIwNC0yLjM1OC4wMDJ6bTEuMzkzLjI1OWwuNDA1IDEuNTA2QTIuNDIxIDIuNDIxIDAgMDA5LjgzIDYuODc5bDEuNTA3LjQwOGMuMjE4LjA1OC4yMTguMzY4IDAgLjQyN2wtMS41MDUuNDA1YTIuNDIyIDIuNDIyIDAgMDAtMS43MTMgMS43MWwtLjQwNSAxLjUwNmMtLjA1OS4yMi0uMzY4LjIyLS40MjYuMDAxbC0uNDA5LTEuNTA5YTIuNDE3IDIuNDE3IDAgMDAtMS43MS0xLjcwOGwtMS41MDUtLjQwNWMtLjIxNy0uMDU5LS4yMTctLjM3LS4wMDEtLjQyN0w1LjE3IDYuODhhMi40MTggMi40MTggMCAwMDEuNzA5LTEuNzFsLjQwNy0xLjUwNWMuMDU5LS4yMTguMzY5LS4yMTguNDI3IDB6IiBmaWxsLW9wYWNpdHk9Ii40IiBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+",blocks:[{opcode:"goToPart",text:D({id:"faceSensing.goToPart",default:"go to [PART]",description:""}),blockType:t.COMMAND,arguments:{PART:{type:e.STRING,menu:"PART",defaultValue:"2"}},filter:[a.SPRITE]},{opcode:"pointInFaceTiltDirection",text:D({id:"faceSensing.pointInFaceTiltDirection",default:"point in direction of face tilt",description:""}),blockType:t.COMMAND,filter:[a.SPRITE]},{opcode:"setSizeToFaceSize",text:D({id:"faceSensing.setSizeToFaceSize",default:"set size to face size",description:""}),blockType:t.COMMAND,filter:[a.SPRITE]},"---",{opcode:"whenTilted",text:D({id:"faceSensing.whenTilted",default:"when face tilts [DIRECTION]",description:""}),blockType:t.HAT,arguments:{DIRECTION:{type:e.STRING,menu:"TILT",defaultValue:"left"}}},{opcode:"whenSpriteTouchesPart",text:D({id:"faceSensing.whenSpriteTouchesPart",default:"when this sprite touches a[PART]",description:""}),arguments:{PART:{type:e.STRING,menu:"PART",defaultValue:"2"}},blockType:t.HAT,filter:[a.SPRITE]},{opcode:"whenFaceDetected",text:D({id:"faceSensing.whenFaceDetected",default:"when a face is detected",description:""}),blockType:t.HAT},"---",{opcode:"faceIsDetected",text:D({id:"faceSensing.faceDetected",default:"a face is detected?",description:""}),blockType:t.BOOLEAN},{opcode:"faceTilt",text:D({id:"faceSensing.faceTilt",default:"face tilt",description:""}),blockType:t.REPORTER},{opcode:"faceSize",text:D({id:"faceSensing.faceSize",default:"face size",description:""}),blockType:t.REPORTER}],menus:{PART:[{text:D({id:"faceSensing.nose",default:"nose"}),value:"2"},{text:D({id:"faceSensing.mouth",default:"mouth"}),value:"3"},{text:D({id:"faceSensing.leftEye",default:"left eye"}),value:"0"},{text:D({id:"faceSensing.rightEye",default:"right eye"}),value:"1"},{text:D({id:"faceSensing.betweenEyes",default:"between eyes"}),value:"6"},{text:D({id:"faceSensing.leftEar",default:"left ear"}),value:"4"},{text:D({id:"faceSensing.rightEar",default:"right ear"}),value:"5"},{text:D({id:"faceSensing.topOfHead",default:"top of head"}),value:"7"}],TILT:[{text:D({id:"faceSensing.left",default:"left"}),value:"left"},{text:D({id:"faceSensing.right",default:"right"}),value:"right"}]}}}getBetweenEyesPosition(){var e=this.getPartPosition(0),t=this.getPartPosition(1),M={x:0,y:0};return M.x=e.x+(t.x-e.x)/2,M.y=e.y+(t.y-e.y)/2,M}getTopOfHeadPosition(){var e=this.getPartPosition(0),t=this.getPartPosition(1),M=this.getPartPosition(3),i=t.x-e.x,t=t.y-e.y,e=Math.atan2(t,i)+Math.PI/2,t=this.getBetweenEyesPosition(),i=this.distance(t,M);return(M={x:0,y:0}).x=t.x+i*Math.cos(e),M.y=t.y+i*Math.sin(e),M}distance(e,t){var M=e.x-t.x,e=e.y-t.y;return Math.sqrt(M*M+e*e)}whenSpriteTouchesPart(e,t){var M;return!!this.currentFace&&!!this.currentFace.keypoints&&(M=(e=this.getPartPosition(e.PART)).x+240,e=180-e.y,t.target.isTouchingPoint(M,e))}whenFaceDetected(){return this.smoothedIsDetected}faceIsDetected(){return this.smoothedIsDetected}numberOfFaces(){return this.allFaces.length}probability(){return this.currentFace?Math.round(100*this.currentFace.probability):0}faceSize(){var e;return this.currentFace&&this.currentFace.box?(e=Math.round(this.currentFace.box.width),this.cachedSize=e):this.cachedSize}getPartPosition(e){var t={x:0,y:0};return this.currentFace&&this.currentFace.keypoints?6===Number(e)?this.getBetweenEyesPosition():7===Number(e)?this.getTopOfHeadPosition():(e=this.currentFace.keypoints[Number(e)])?this.toScratchCoords(e):t:t}toScratchCoords(e){return{x:e.x-240,y:180-e.y}}partX(e){return this.getPartPosition(e.PART).x}partY(e){return this.getPartPosition(e.PART).y}whenTilted(e){return"left"===e.DIRECTION?this.faceTilt()<80:"right"===e.DIRECTION&&100<this.faceTilt()}goToPart(e,t){this.currentFace&&(e=this.getPartPosition(e.PART),t.target.setXY(e.x,e.y))}pointInFaceTiltDirection(e,t){this.currentFace&&t.target.setDirection(this.faceTilt())}setSizeToFaceSize(e,t){this.currentFace&&t.target.setSize(this.faceSize())}attachToPart(e,t){var M=this._getFaceSensingState(t.target);M.attachedToPartNumber=e.PART,M.offsetX=0,M.offsetY=0,M.prevX=t.target.x,M.prevY=t.target.y,M.offsetDirection=0,M.prevDirection=t.target.direction,M.offsetSize=0,M.prevSize=t.target.size}updateAttachments(){const i=this;this.runtime.targets.forEach(e=>{var t,M=i._getFaceSensingState(e);M.attachedToPartNumber&&(t=i.getPartPosition(M.attachedToPartNumber),e.x!==M.prevX&&(M.offsetX+=e.x-M.prevX),e.y!==M.prevY&&(M.offsetY+=e.y-M.prevY),e.direction!==M.prevDirection&&(M.offsetDirection+=e.direction-M.prevDirection),e.size!==M.prevSize&&(M.offsetSize+=e.size-M.prevSize),e.setXY(t.x+M.offsetX,t.y+M.offsetY),e.setDirection(i.faceTilt()+M.offsetDirection),e.setSize(i.faceSize()+M.offsetSize),M.prevX=e.x,M.prevY=e.y,M.prevDirection=e.direction,M.prevSize=e.size)})}_clearAttachments(){this.runtime.targets.forEach(e=>{this._getFaceSensingState(e).attachedToPartNumber=null})}faceTilt(){var e,t,M;return this.currentFace?(t=this.getPartPosition(0),e=(M=this.getPartPosition(1)).x-t.x,M=M.y-t.y,t=90-i.radToDeg(Math.atan2(M,e)),M=Math.round(t),this.cachedTilt=M):this.cachedTilt}}),Scratch.extensions.translations({en:{"faceSensing.categoryName":"Face Sensing","faceSensing.goToPart":"go to [PART]","faceSensing.pointInFaceTiltDirection":"point in direction of face tilt","faceSensing.setSizeToFaceSize":"set size to face size","faceSensing.whenTilted":"when face tilts [DIRECTION]","faceSensing.whenSpriteTouchesPart":"when this sprite touches a[PART]","faceSensing.whenFaceDetected":"when a face is detected","faceSensing.faceDetected":"a face is detected?","faceSensing.faceTilt":"face tilt","faceSensing.faceSize":"face size","faceSensing.nose":"nose","faceSensing.mouth":"mouth","faceSensing.leftEye":"left eye","faceSensing.rightEye":"right eye","faceSensing.betweenEyes":"between eyes","faceSensing.leftEar":"left ear","faceSensing.rightEar":"right ear","faceSensing.topOfHead":"top of head","faceSensing.left":"left","faceSensing.right":"right"},"zh-cn":{"faceSensing.categoryName":"脸部侦测","faceSensing.goToPart":"移到 [PART]","faceSensing.pointInFaceTiltDirection":"面向脸部倾斜的方向","faceSensing.setSizeToFaceSize":"将大小设为脸部大小","faceSensing.whenTilted":"当脸部往 [DIRECTION] 倾斜","faceSensing.whenSpriteTouchesPart":"当角色碰到 [PART]","faceSensing.whenFaceDetected":"当检测到脸部","faceSensing.faceDetected":"检测到脸部？","faceSensing.faceTilt":"脸部倾斜方向","faceSensing.faceSize":"脸部大小","faceSensing.nose":"鼻子","faceSensing.mouth":"嘴巴","faceSensing.leftEye":"左眼","faceSensing.rightEye":"右眼","faceSensing.betweenEyes":"两眼之间","faceSensing.leftEar":"左耳","faceSensing.rightEar":"右耳","faceSensing.topOfHead":"头顶","faceSensing.left":"左","faceSensing.right":"右"},"zh-tw":{"faceSensing.categoryName":"臉部偵測","faceSensing.goToPart":"移到 [PART]","faceSensing.pointInFaceTiltDirection":"面向臉部傾斜的方向","faceSensing.setSizeToFaceSize":"將大小設為臉部大小","faceSensing.whenTilted":"當臉部往 [DIRECTION] 傾斜","faceSensing.whenSpriteTouchesPart":"當角色碰到 [PART]","faceSensing.whenFaceDetected":"當檢測到臉部","faceSensing.faceDetected":"檢測到臉部？","faceSensing.faceTilt":"臉部傾斜方向","faceSensing.faceSize":"臉部大小","faceSensing.nose":"鼻子","faceSensing.mouth":"嘴巴","faceSensing.leftEye":"左眼","faceSensing.rightEye":"右眼","faceSensing.betweenEyes":"兩眼之間","faceSensing.leftEar":"左耳","faceSensing.rightEar":"右耳","faceSensing.topOfHead":"頭頂","faceSensing.left":"左","faceSensing.right":"右"}})}();