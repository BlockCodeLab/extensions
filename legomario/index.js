!function(e){const o=e.ArgumentType,r=e.BlockType,i=e.Buffer,a=e.BLE,t=e.Base64Util,l=e.Cast,n=e.formatMessage,s=e.RateLimiter,g="lego mario extension stopped receiving data",c={service:"00001623-1212-efde-1623-785feabcd123",characteristic:"00001624-1212-efde-1623-785feabcd123",sendRateMax:20},u={COLOR_BARCODE_SENSOR:73,PANTS:74},d={HUB_PROPERTIES:1,HUB_ACTIONS:2,HUB_ALERTS:3,HUB_ATTACHED_IO:4,ERROR:5,PORT_INPUT_FORMAT_SETUP_SINGLE:65,PORT_INPUT_FORMAT_SETUP_COMBINED:66,PORT_INFORMATION:67,PORT_MODEINFORMATION:68,PORT_VALUE:69,PORT_VALUE_COMBINED:70,PORT_INPUT_FORMAT:71,PORT_INPUT_FORMAT_COMBINED:72,OUTPUT:129,PORT_FEEDBACK:130},m={ADVERTISEMENT_NAME:1,BUTTON:2,FW_VERSION:3,HW_VERSION:4,RSSI:5,BATTERY_VOLTAGE:6,BATTERY_TYPE:7,MANUFACTURER_NAME:8,RADIO_FW_VERSION:9,LEGO_WP_VERSION:10,SYSTEM_TYPE_ID:11,HW_NETWORK_ID:12,PRIMARY_MAC:13,SECONDARY_MAC:14,HW_NETWORK_FAMILY:15},N={SET:1,ENABLE_UPDATES:2,DISABLE_UPDATES:3,RESET:4,REQUEST_UPDATE:5,UPDATE:6},E={ATTACHED:1,DETACHED:0,ATTACHED_VIRTUAL:2},O={COLOR:0,PANTS:0,UNKNOWN:0},R={WHITE:19,RED:21,BLUE:23,YELLOW:24,BLACK:26,GREEN:37,BROWN:106,PURPLE:268,NOUGAT_BROWN:312,CYAN:322,NONE:-1},p={NONE:0,BEE:3,LUIGI:5,FROG:6,TANOOKI:10,PROPELLER:12,CAT:17,FIRE:18,PENGUIN:20,MARIO:33,BUILDER:34},I=e=>{var o=new ArrayBuffer(4),o=new DataView(o);return o.setInt32(0,e),[o.getInt8(3),o.getInt8(2),o.getInt8(1),o.getInt8(0)]};class T{constructor(e,o){this._runtime=e,this._extensionId=o,this._ports=[],this._sensors={barcode:R.NONE,color:R.NONE,pants:p.NONE},this._ble=null,this._runtime.registerPeripheralExtension(o,this),this._timeoutID=null,this._rateLimiter=new s(c.sendRateMax),this.reset=this.reset.bind(this),this._onConnect=this._onConnect.bind(this),this._onMessage=this._onMessage.bind(this)}get barcode(){return this._sensors.barcode}get color(){return this._sensors.color}get pants(){return this._sensors.pants}scan(){this._ble&&this._ble.disconnect(),this._ble=new a(this._runtime,this._extensionId,{filters:[{services:[c.service]}],optionalServices:[]},this._onConnect,this.reset)}connect(e){this._ble&&this._ble.connectPeripheral(e)}disconnect(){this._ble&&this._ble.disconnect(),this.reset()}reset(){this._timeoutID=null,this._ports=[],this._sensors={barcode:R.NONE,color:R.NONE,pants:p.NONE}}isConnected(){let e=!1;return e=this._ble?this._ble.isConnected():e}send(e,o,r=!0){return!this.isConnected()||r&&!this._rateLimiter.okayToSend()?Promise.resolve():this._ble.write(c.service,e,t.uint8ArrayToBase64(o),"base64")}generateInputCommand(e,o,r,a){e=[0,d.PORT_INPUT_FORMAT_SETUP_SINGLE,e,o].concat(I(r)).concat([a]);return e.unshift(e.length+1),e}_onConnect(){this._ble.startNotifications(c.service,c.characteristic,this._onMessage),setTimeout(()=>{var e=[0,d.HUB_PROPERTIES,m.FW_VERSION,N.REQUEST_UPDATE];e.unshift(e.length+1),this.send(c.characteristic,e,!1)},500),this._timeoutID=window.setTimeout(()=>this._ble.handleDisconnectError(g),4500)}_onMessage(e){var o=e[2],r=e[3];switch(o){case d.HUB_ATTACHED_IO:var a=e[4],t=e[5];switch(a){case E.ATTACHED:this._registerSensor(r,t);break;case E.DETACHED:this._clearPort(r);break;case E.ATTACHED_VIRTUAL:}break;case d.PORT_VALUE:var a=this._ports[r],l=i.from(e.slice(4));switch(a){case u.COLOR_BARCODE_SENSOR:this._sensors.barcode=l.readInt16LE(0),this._sensors.color=l.readInt16LE(2);break;case u.PANTS:this._sensors.pants=l.readInt8(0)}break;case d.ERROR:log.error("Error reported by hub: "+e)}window.clearTimeout(this._timeoutID),this._timeoutID=window.setTimeout(()=>this._ble.handleDisconnectError(g),4500)}_registerSensor(e,o){let r=null,a=1;switch(this._ports[e]=o){case u.COLOR_BARCODE_SENSOR:r=O.COLOR,a=0;break;case u.PANTS:r=O.PANTS,a=0;break;default:r=O.UNKNOWN}o=this.generateInputCommand(e,r,a,!0);this.send(c.characteristic,o)}_clearPort(e){var o=this._ports[e];o===u.COLOR_BARCODE_SENSOR&&(this._sensors.barcode=R.NONE,this._sensors.color=R.NONE),o===u.PANTS&&(this._sensors.pants=p.NONE),this._ports[e]="none"}}e.extensions.register(new class h{static get EXTENSION_ID(){return"legomario"}constructor(){this.runtime=e.vm.runtime,this._peripheral=new T(this.runtime,h.EXTENSION_ID)}get ColorLabel(){return{[R.WHITE]:n({id:"legomario.color.white",default:"White"}),[R.RED]:n({id:"legomario.color.red",default:"Red"}),[R.BLUE]:n({id:"legomario.color.blue",default:"Blue"}),[R.YELLOW]:n({id:"legomario.color.yellow",default:"Yellow"}),[R.BLACK]:n({id:"legomario.color.black",default:"Black"}),[R.GREEN]:n({id:"legomario.color.green",default:"Green"}),[R.BROWN]:n({id:"legomario.color.brown",default:"Brown"}),[R.PURPLE]:n({id:"legomario.color.purple",default:"Purple"}),[R.NOUGAT_BROWN]:n({id:"legomario.color.nougatBrown",default:"Nougat Brown"}),[R.CYAN]:n({id:"legomario.color.cyan",default:"Cyan"}),[R.NONE]:n({id:"legomario.color.noColor",default:"No color"})}}get PantsLabel(){return{[p.NONE]:n({id:"legomario.pants.none",default:"None"}),[p.BEE]:n({id:"legomario.pants.bee",default:"Bee"}),[p.LUIGI]:n({id:"legomario.pants.luigi",default:"Luigi"}),[p.FROG]:n({id:"legomario.pants.frog",default:"Frog"}),[p.TANOOKI]:n({id:"legomario.pants.tanooki",default:"Tanooki"}),[p.PROPELLER]:n({id:"legomario.pants.propeller",default:"Propeller"}),[p.CAT]:n({id:"legomario.pants.cat",default:"Cat"}),[p.FIRE]:n({id:"legomario.pants.fire",default:"Fire"}),[p.PENGUIN]:n({id:"legomario.pants.penguin",default:"Penguin"}),[p.MARIO]:n({id:"legomario.pants.mario",default:"Mario"}),[p.BUILDER]:n({id:"legomario.pants.builder",default:"Builder"})}}get SensorColor(){return[{text:n({id:"legomario.color.white",default:"White"}),value:R.WHITE},{text:n({id:"legomario.color.red",default:"Red"}),value:R.RED},{text:n({id:"legomario.color.blue",default:"Blue"}),value:R.BLUE},{text:n({id:"legomario.color.yellow",default:"Yellow"}),value:R.YELLOW},{text:n({id:"legomario.color.black",default:"Black"}),value:R.BLACK},{text:n({id:"legomario.color.green",default:"Green"}),value:R.GREEN},{text:n({id:"legomario.color.brown",default:"Brown"}),value:R.BROWN},{text:n({id:"legomario.color.purple",default:"Purple"}),value:R.PURPLE},{text:n({id:"legomario.color.nougatBrown",default:"Nougat Brown"}),value:R.NOUGAT_BROWN},{text:n({id:"legomario.color.cyan",default:"Cyan"}),value:R.CYAN},{text:n({id:"legomario.color.noColor",default:"No color"}),value:R.NONE}]}get Pants(){return[{text:n({id:"legomario.pants.none",default:"None"}),value:p.NONE},{text:n({id:"legomario.pants.bee",default:"Bee"}),value:p.BEE},{text:n({id:"legomario.pants.luigi",default:"Luigi"}),value:p.LUIGI},{text:n({id:"legomario.pants.frog",default:"Frog"}),value:p.FROG},{text:n({id:"legomario.pants.tanooki",default:"Tanooki"}),value:p.TANOOKI},{text:n({id:"legomario.pants.propeller",default:"Propeller"}),value:p.PROPELLER},{text:n({id:"legomario.pants.cat",default:"Cat"}),value:p.CAT},{text:n({id:"legomario.pants.fire",default:"Fire"}),value:p.FIRE},{text:n({id:"legomario.pants.penguin",default:"Penguin"}),value:p.PENGUIN},{text:n({id:"legomario.pants.mario",default:"Mario"}),value:p.MARIO},{text:n({id:"legomario.pants.builder",default:"Builder"}),value:p.BUILDER}]}getInfo(){return{id:h.EXTENSION_ID,name:"LEGO Mario",blockIconURI:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU5LjEgKDg2MTQ0KSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5sZWdvbWFyaW8tc21hbGw8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0ibGVnb21hcmlvLXNtYWxsIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsIiBmaWxsPSIjRkZGRkZGIiBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiPjwvY2lyY2xlPgogICAgICAgIDxwb2x5bGluZSBpZD0iUGF0aC0yIiBmaWxsPSIjRkYwMDAwIiBwb2ludHM9IjIwIDE0LjQ2NDk2OTggMTIuNjE0MTYzMyA1Ljg5NzkzMzQ3IDMuMTMzODIwNTYgMjUuMzYyMzk5MiA5LjE2MTI5MDMyIDMwLjMwNjE5OTYgMTQuMTg4NTA4MSAxNS41MTI2MDA4IDIwIDIyLjY2MDUzNDMiPjwvcG9seWxpbmU+CiAgICAgICAgPHBvbHlsaW5lIGlkPSJQYXRoLTItQ29weSIgZmlsbD0iI0ZGMDAwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjguNDMzMDkwLCAxOC4xMDIwNjcpIHNjYWxlKC0xLCAxKSB0cmFuc2xhdGUoLTI4LjQzMzA5MCwgLTE4LjEwMjA2NykgIiBwb2ludHM9IjM2Ljg2NjE3OTQgMTQuNDY0OTY5OCAyOS40ODAzNDI3IDUuODk3OTMzNDcgMjAgMjUuMzYyMzk5MiAyNi4wMjc0Njk4IDMwLjMwNjE5OTYgMzEuMDU0Njg3NSAxNS41MTI2MDA4IDM2Ljg2NjE3OTQgMjIuNjYwNTM0MyI+PC9wb2x5bGluZT4KICAgIDwvZz4KPC9zdmc+",showStatusButton:!0,blocks:[{opcode:"whenBarcode",text:n({id:"legomario.whenBarcode",default:"when barcode is [BARCODE]"}),blockType:r.HAT,arguments:{BARCODE:{type:o.NUMBER,defaultValue:2}}},{opcode:"whenAnyBarcode",text:n({id:"legomario.whenAnyBarcode",default:"when any barcode is found"}),blockType:r.HAT},{opcode:"getBarcode",text:n({id:"legomario.getBarcode",default:"barcode"}),blockType:r.REPORTER},"---",{opcode:"whenColor",text:n({id:"legomario.whenColor",default:"when color is [SENSOR_COLOR]"}),blockType:r.HAT,arguments:{SENSOR_COLOR:{type:o.NUMBER,menu:"SENSOR_COLOR",defaultValue:R.RED}}},{opcode:"isColor",text:n({id:"legomario.isColor",default:"color is [SENSOR_COLOR] ?"}),blockType:r.BOOLEAN,arguments:{SENSOR_COLOR:{type:o.NUMBER,menu:"SENSOR_COLOR",defaultValue:R.RED}}},{opcode:"getColor",text:n({id:"legomario.getColor",default:"color"}),blockType:r.REPORTER},"---",{opcode:"whenPants",text:n({id:"legomario.whenPants",default:"when pants is [PANTS]"}),blockType:r.HAT,arguments:{PANTS:{type:o.NUMBER,menu:"PANTS",defaultValue:p.FIRE}}},{opcode:"isPants",text:n({id:"legomario.isPants",default:"pants is [PANTS] ?"}),blockType:r.BOOLEAN,arguments:{PANTS:{type:o.NUMBER,menu:"PANTS",defaultValue:p.MARIO}}},{opcode:"getPants",text:n({id:"legomario.getPants",default:"pants"}),blockType:r.REPORTER}],menus:{SENSOR_COLOR:this.SensorColor,PANTS:this.Pants}}}whenBarcode(e){return this._peripheral.barcode==l.toNumber(e.BARCODE)}whenAnyBarcode(){return this._peripheral.barcode!=R.NONE}getBarcode(){return this._peripheral.barcode}whenColor(e){return this._peripheral.color==l.toNumber(e.SENSOR_COLOR)}isColor(e){return this._peripheral.color==l.toNumber(e.SENSOR_COLOR)}getColor(){return this.ColorLabel[this._peripheral.color]||this.ColorLabel[R.NONE]}whenPants(e){return this._peripheral.pants==l.toNumber(e.PANTS)}isPants(e){return this._peripheral.pants==l.toNumber(e.PANTS)}getPants(){return this.PantsLabel[this._peripheral.pants]||this.PantsLabel[p.NONE]}}),e.extensions.translations({en:{"legomario.whenBarcode":"when barcode is [BARCODE]","legomario.whenAnyBarcode":"when any barcode is found","legomario.getBarcode":"barcode","legomario.whenColor":"when color is [SENSOR_COLOR]","legomario.isColor":"color is [SENSOR_COLOR] ?","legomario.getColor":"color","legomario.whenPants":"when pants is [PANTS]","legomario.isPants":"pants is [PANTS] ?","legomario.getPants":"pants","legomario.color.white":"White","legomario.color.red":"Red","legomario.color.blue":"Blue","legomario.color.yellow":"Yellow","legomario.color.black":"Black","legomario.color.green":"Green","legomario.color.brown":"Brown","legomario.color.purple":"Purple","legomario.color.nougatBrown":"Nougat Brown","legomario.color.cyan":"Cyan","legomario.color.noColor":"No color","legomario.pants.none":"None","legomario.pants.bee":"Bee","legomario.pants.luigi":"Luigi","legomario.pants.frog":"Frog","legomario.pants.tanooki":"Tanooki","legomario.pants.propeller":"Propeller","legomario.pants.cat":"Cat","legomario.pants.fire":"Fire","legomario.pants.penguin":"Penguin","legomario.pants.mario":"Mario","legomario.pants.builder":"Builder"},"zh-cn":{"legomario.whenBarcode":"当条形码是[BARCODE]","legomario.whenAnyBarcode":"当扫描到任意条形码","legomario.getBarcode":"条形码","legomario.whenColor":"当颜色是[SENSOR_COLOR]","legomario.isColor":"颜色是[SENSOR_COLOR]?","legomario.getColor":"颜色","legomario.whenPants":"当服装是[PANTS]","legomario.isPants":"服装是[PANTS]?","legomario.getPants":"服装","legomario.color.white":"白色","legomario.color.red":"红色","legomario.color.blue":"蓝色","legomario.color.yellow":"黄色","legomario.color.black":"黑色","legomario.color.green":"绿色","legomario.color.brown":"棕色","legomario.color.purple":"紫色","legomario.color.nougatBrown":"淡棕色","legomario.color.cyan":"青色","legomario.color.noColor":"无色","legomario.pants.none":"无","legomario.pants.bee":"蜜蜂","legomario.pants.luigi":"路易吉","legomario.pants.frog":"青蛙","legomario.pants.tanooki":"狸猫","legomario.pants.propeller":"螺旋桨","legomario.pants.cat":"猫咪","legomario.pants.fire":"火焰","legomario.pants.penguin":"企鹅","legomario.pants.mario":"马力欧","legomario.pants.builder":"建筑工"},"zh-tw":{"legomario.whenBarcode":"當條形碼是[BARCODE]","legomario.whenAnyBarcode":"當掃描到任意條形碼","legomario.getBarcode":"條形碼","legomario.whenColor":"當顏色是[SENSOR_COLOR]","legomario.isColor":"顏色是[SENSOR_COLOR]?","legomario.getColor":"顏色","legomario.whenPants":"當服裝是[PANTS]","legomario.isPants":"服裝是[PANTS]?","legomario.getPants":"服裝","legomario.color.white":"白色","legomario.color.red":"紅色","legomario.color.blue":"藍色","legomario.color.yellow":"黃色","legomario.color.black":"黑色","legomario.color.green":"綠色","legomario.color.brown":"棕色","legomario.color.purple":"紫色","legomario.color.nougatBrown":"淡棕色","legomario.color.cyan":"青色","legomario.color.noColor":"無色","legomario.pants.none":"無","legomario.pants.bee":"蜜蜂","legomario.pants.luigi":"路易吉","legomario.pants.frog":"青蛙","legomario.pants.tanooki":"貍貓","legomario.pants.propeller":"螺旋槳","legomario.pants.cat":"貓咪","legomario.pants.fire":"火焰","legomario.pants.penguin":"企鵝","legomario.pants.mario":"瑪利歐","legomario.pants.builder":"建築工"}})}(Scratch);