!function(){const e=Scratch.ArgumentType,o=Scratch.BlockType,i=Scratch.Buffer,r=Scratch.BLE,a=Scratch.Base64Util,t=Scratch.Cast,l=Scratch.formatMessage,n=Scratch.RateLimiter,s="lego mario extension stopped receiving data",g={service:"00001623-1212-efde-1623-785feabcd123",characteristic:"00001624-1212-efde-1623-785feabcd123",sendRateMax:20},c={COLOR_BARCODE_SENSOR:73,PANTS:74},u={HUB_PROPERTIES:1,HUB_ACTIONS:2,HUB_ALERTS:3,HUB_ATTACHED_IO:4,ERROR:5,PORT_INPUT_FORMAT_SETUP_SINGLE:65,PORT_INPUT_FORMAT_SETUP_COMBINED:66,PORT_INFORMATION:67,PORT_MODEINFORMATION:68,PORT_VALUE:69,PORT_VALUE_COMBINED:70,PORT_INPUT_FORMAT:71,PORT_INPUT_FORMAT_COMBINED:72,OUTPUT:129,PORT_FEEDBACK:130},d={ADVERTISEMENT_NAME:1,BUTTON:2,FW_VERSION:3,HW_VERSION:4,RSSI:5,BATTERY_VOLTAGE:6,BATTERY_TYPE:7,MANUFACTURER_NAME:8,RADIO_FW_VERSION:9,LEGO_WP_VERSION:10,SYSTEM_TYPE_ID:11,HW_NETWORK_ID:12,PRIMARY_MAC:13,SECONDARY_MAC:14,HW_NETWORK_FAMILY:15},m={SET:1,ENABLE_UPDATES:2,DISABLE_UPDATES:3,RESET:4,REQUEST_UPDATE:5,UPDATE:6},N={ATTACHED:1,DETACHED:0,ATTACHED_VIRTUAL:2},E={COLOR:0,PANTS:0,UNKNOWN:0},O={WHITE:19,RED:21,BLUE:23,YELLOW:24,BLACK:26,GREEN:37,BROWN:106,PURPLE:268,NOUGAT_BROWN:312,CYAN:322,NONE:-1},R={NONE:0,BEE:3,LUIGI:5,FROG:6,TANOOKI:10,PROPELLER:12,CAT:17,FIRE:18,PENGUIN:20,MARIO:33,BUILDER:34},h=e=>{var o=new ArrayBuffer(4),o=new DataView(o);return o.setInt32(0,e),[o.getInt8(3),o.getInt8(2),o.getInt8(1),o.getInt8(0)]};class p{constructor(e,o){this._runtime=e,this._extensionId=o,this._ports=[],this._sensors={barcode:O.NONE,color:O.NONE,pants:R.NONE},this._ble=null,this._runtime.registerPeripheralExtension(o,this),this._timeoutID=null,this._rateLimiter=new n(g.sendRateMax),this.reset=this.reset.bind(this),this._onConnect=this._onConnect.bind(this),this._onMessage=this._onMessage.bind(this)}get barcode(){return this._sensors.barcode}get color(){return this._sensors.color}get pants(){return this._sensors.pants}scan(){this._ble&&this._ble.disconnect(),this._ble=new r(this._runtime,this._extensionId,{filters:[{services:[g.service]}],optionalServices:[]},this._onConnect,this.reset)}connect(e){this._ble&&this._ble.connectPeripheral(e)}disconnect(){this._ble&&this._ble.disconnect(),this.reset()}reset(){this._timeoutID=null,this._ports=[],this._sensors={barcode:O.NONE,color:O.NONE,pants:R.NONE}}isConnected(){let e=!1;return e=this._ble?this._ble.isConnected():e}send(e,o,r=!0){return!this.isConnected()||r&&!this._rateLimiter.okayToSend()?Promise.resolve():this._ble.write(g.service,e,a.uint8ArrayToBase64(o),"base64")}generateInputCommand(e,o,r,a){e=[0,u.PORT_INPUT_FORMAT_SETUP_SINGLE,e,o].concat(h(r)).concat([a]);return e.unshift(e.length+1),e}_onConnect(){this._ble.startNotifications(g.service,g.characteristic,this._onMessage),setTimeout(()=>{var e=[0,u.HUB_PROPERTIES,d.FW_VERSION,m.REQUEST_UPDATE];e.unshift(e.length+1),this.send(g.characteristic,e,!1)},500),this._timeoutID=window.setTimeout(()=>this._ble.handleDisconnectError(s),4500)}_onMessage(e){var o=e[2],r=e[3];switch(o){case u.HUB_ATTACHED_IO:var a=e[4],t=e[5];switch(a){case N.ATTACHED:this._registerSensor(r,t);break;case N.DETACHED:this._clearPort(r);break;case N.ATTACHED_VIRTUAL:}break;case u.PORT_VALUE:var a=this._ports[r],l=i.from(e.slice(4));switch(a){case c.COLOR_BARCODE_SENSOR:this._sensors.barcode=l.readInt16LE(0),this._sensors.color=l.readInt16LE(2);break;case c.PANTS:this._sensors.pants=l.readInt8(0)}break;case u.ERROR:log.error("Error reported by hub: "+e)}window.clearTimeout(this._timeoutID),this._timeoutID=window.setTimeout(()=>this._ble.handleDisconnectError(s),4500)}_registerSensor(e,o){let r=null,a=1;switch(this._ports[e]=o){case c.COLOR_BARCODE_SENSOR:r=E.COLOR,a=0;break;case c.PANTS:r=E.PANTS,a=0;break;default:r=E.UNKNOWN}o=this.generateInputCommand(e,r,a,!0);this.send(g.characteristic,o)}_clearPort(e){var o=this._ports[e];o===c.COLOR_BARCODE_SENSOR&&(this._sensors.barcode=O.NONE,this._sensors.color=O.NONE),o===c.PANTS&&(this._sensors.pants=R.NONE),this._ports[e]="none"}}Scratch.extensions.register(new class I{static get EXTENSION_ID(){return"legomario"}constructor(){this.runtime=Scratch.vm.runtime,this._peripheral=new p(this.runtime,I.EXTENSION_ID)}get ColorLabel(){return{[O.WHITE]:l({id:"legomario.color.white",default:"White"}),[O.RED]:l({id:"legomario.color.red",default:"Red"}),[O.BLUE]:l({id:"legomario.color.blue",default:"Blue"}),[O.YELLOW]:l({id:"legomario.color.yellow",default:"Yellow"}),[O.BLACK]:l({id:"legomario.color.black",default:"Black"}),[O.GREEN]:l({id:"legomario.color.green",default:"Green"}),[O.BROWN]:l({id:"legomario.color.brown",default:"Brown"}),[O.PURPLE]:l({id:"legomario.color.purple",default:"Purple"}),[O.NOUGAT_BROWN]:l({id:"legomario.color.nougatBrown",default:"Nougat Brown"}),[O.CYAN]:l({id:"legomario.color.cyan",default:"Cyan"}),[O.NONE]:l({id:"legomario.color.noColor",default:"No color"})}}get PantsLabel(){return{[R.NONE]:l({id:"legomario.pants.none",default:"None"}),[R.BEE]:l({id:"legomario.pants.bee",default:"Bee"}),[R.LUIGI]:l({id:"legomario.pants.luigi",default:"Luigi"}),[R.FROG]:l({id:"legomario.pants.frog",default:"Frog"}),[R.TANOOKI]:l({id:"legomario.pants.tanooki",default:"Tanooki"}),[R.PROPELLER]:l({id:"legomario.pants.propeller",default:"Propeller"}),[R.CAT]:l({id:"legomario.pants.cat",default:"Cat"}),[R.FIRE]:l({id:"legomario.pants.fire",default:"Fire"}),[R.PENGUIN]:l({id:"legomario.pants.penguin",default:"Penguin"}),[R.MARIO]:l({id:"legomario.pants.mario",default:"Mario"}),[R.BUILDER]:l({id:"legomario.pants.builder",default:"Builder"})}}get SensorColor(){return[{text:l({id:"legomario.color.white",default:"White"}),value:O.WHITE},{text:l({id:"legomario.color.red",default:"Red"}),value:O.RED},{text:l({id:"legomario.color.blue",default:"Blue"}),value:O.BLUE},{text:l({id:"legomario.color.yellow",default:"Yellow"}),value:O.YELLOW},{text:l({id:"legomario.color.black",default:"Black"}),value:O.BLACK},{text:l({id:"legomario.color.green",default:"Green"}),value:O.GREEN},{text:l({id:"legomario.color.brown",default:"Brown"}),value:O.BROWN},{text:l({id:"legomario.color.purple",default:"Purple"}),value:O.PURPLE},{text:l({id:"legomario.color.nougatBrown",default:"Nougat Brown"}),value:O.NOUGAT_BROWN},{text:l({id:"legomario.color.cyan",default:"Cyan"}),value:O.CYAN},{text:l({id:"legomario.color.noColor",default:"No color"}),value:O.NONE}]}get Pants(){return[{text:l({id:"legomario.pants.none",default:"None"}),value:R.NONE},{text:l({id:"legomario.pants.bee",default:"Bee"}),value:R.BEE},{text:l({id:"legomario.pants.luigi",default:"Luigi"}),value:R.LUIGI},{text:l({id:"legomario.pants.frog",default:"Frog"}),value:R.FROG},{text:l({id:"legomario.pants.tanooki",default:"Tanooki"}),value:R.TANOOKI},{text:l({id:"legomario.pants.propeller",default:"Propeller"}),value:R.PROPELLER},{text:l({id:"legomario.pants.cat",default:"Cat"}),value:R.CAT},{text:l({id:"legomario.pants.fire",default:"Fire"}),value:R.FIRE},{text:l({id:"legomario.pants.penguin",default:"Penguin"}),value:R.PENGUIN},{text:l({id:"legomario.pants.mario",default:"Mario"}),value:R.MARIO},{text:l({id:"legomario.pants.builder",default:"Builder"}),value:R.BUILDER}]}getInfo(){return{id:I.EXTENSION_ID,name:"LEGO Mario",blockIconURI:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU5LjEgKDg2MTQ0KSAtIGh0dHBzOi8vc2tldGNoLmNvbSAtLT4KICAgIDx0aXRsZT5sZWdvbWFyaW8tc21hbGw8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0ibGVnb21hcmlvLXNtYWxsIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8Y2lyY2xlIGlkPSJPdmFsIiBmaWxsPSIjRkZGRkZGIiBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiPjwvY2lyY2xlPgogICAgICAgIDxwb2x5bGluZSBpZD0iUGF0aC0yIiBmaWxsPSIjRkYwMDAwIiBwb2ludHM9IjIwIDE0LjQ2NDk2OTggMTIuNjE0MTYzMyA1Ljg5NzkzMzQ3IDMuMTMzODIwNTYgMjUuMzYyMzk5MiA5LjE2MTI5MDMyIDMwLjMwNjE5OTYgMTQuMTg4NTA4MSAxNS41MTI2MDA4IDIwIDIyLjY2MDUzNDMiPjwvcG9seWxpbmU+CiAgICAgICAgPHBvbHlsaW5lIGlkPSJQYXRoLTItQ29weSIgZmlsbD0iI0ZGMDAwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjguNDMzMDkwLCAxOC4xMDIwNjcpIHNjYWxlKC0xLCAxKSB0cmFuc2xhdGUoLTI4LjQzMzA5MCwgLTE4LjEwMjA2NykgIiBwb2ludHM9IjM2Ljg2NjE3OTQgMTQuNDY0OTY5OCAyOS40ODAzNDI3IDUuODk3OTMzNDcgMjAgMjUuMzYyMzk5MiAyNi4wMjc0Njk4IDMwLjMwNjE5OTYgMzEuMDU0Njg3NSAxNS41MTI2MDA4IDM2Ljg2NjE3OTQgMjIuNjYwNTM0MyI+PC9wb2x5bGluZT4KICAgIDwvZz4KPC9zdmc+",showStatusButton:!0,blocks:[{opcode:"whenBarcode",text:l({id:"legomario.whenBarcode",default:"when barcode is [BARCODE]"}),blockType:o.HAT,arguments:{BARCODE:{type:e.NUMBER,defaultValue:2}}},{opcode:"whenAnyBarcode",text:l({id:"legomario.whenAnyBarcode",default:"when any barcode is found"}),blockType:o.HAT},{opcode:"getBarcode",text:l({id:"legomario.getBarcode",default:"barcode"}),blockType:o.REPORTER},"---",{opcode:"whenColor",text:l({id:"legomario.whenColor",default:"when color is [SENSOR_COLOR]"}),blockType:o.HAT,arguments:{SENSOR_COLOR:{type:e.NUMBER,menu:"SENSOR_COLOR",defaultValue:O.RED}}},{opcode:"isColor",text:l({id:"legomario.isColor",default:"color is [SENSOR_COLOR] ?"}),blockType:o.BOOLEAN,arguments:{SENSOR_COLOR:{type:e.NUMBER,menu:"SENSOR_COLOR",defaultValue:O.RED}}},{opcode:"getColor",text:l({id:"legomario.getColor",default:"color"}),blockType:o.REPORTER},"---",{opcode:"whenPants",text:l({id:"legomario.whenPants",default:"when pants is [PANTS]"}),blockType:o.HAT,arguments:{PANTS:{type:e.NUMBER,menu:"PANTS",defaultValue:R.FIRE}}},{opcode:"isPants",text:l({id:"legomario.isPants",default:"pants is [PANTS] ?"}),blockType:o.BOOLEAN,arguments:{PANTS:{type:e.NUMBER,menu:"PANTS",defaultValue:R.MARIO}}},{opcode:"getPants",text:l({id:"legomario.getPants",default:"pants"}),blockType:o.REPORTER}],menus:{SENSOR_COLOR:this.SensorColor,PANTS:this.Pants}}}whenBarcode(e){return this._peripheral.barcode==t.toNumber(e.BARCODE)}whenAnyBarcode(){return this._peripheral.barcode!=O.NONE}getBarcode(){return this._peripheral.barcode}whenColor(e){return this._peripheral.color==t.toNumber(e.SENSOR_COLOR)}isColor(e){return this._peripheral.color==t.toNumber(e.SENSOR_COLOR)}getColor(){return this.ColorLabel[this._peripheral.color]||this.ColorLabel[O.NONE]}whenPants(e){return this._peripheral.pants==t.toNumber(e.PANTS)}isPants(e){return this._peripheral.pants==t.toNumber(e.PANTS)}getPants(){return this.PantsLabel[this._peripheral.pants]||this.PantsLabel[R.NONE]}}),Scratch.extensions.translations({en:{"legomario.whenBarcode":"when barcode is [BARCODE]","legomario.whenAnyBarcode":"when any barcode is found","legomario.getBarcode":"barcode","legomario.whenColor":"when color is [SENSOR_COLOR]","legomario.isColor":"color is [SENSOR_COLOR] ?","legomario.getColor":"color","legomario.whenPants":"when pants is [PANTS]","legomario.isPants":"pants is [PANTS] ?","legomario.getPants":"pants","legomario.color.white":"White","legomario.color.red":"Red","legomario.color.blue":"Blue","legomario.color.yellow":"Yellow","legomario.color.black":"Black","legomario.color.green":"Green","legomario.color.brown":"Brown","legomario.color.purple":"Purple","legomario.color.nougatBrown":"Nougat Brown","legomario.color.cyan":"Cyan","legomario.color.noColor":"No color","legomario.pants.none":"None","legomario.pants.bee":"Bee","legomario.pants.luigi":"Luigi","legomario.pants.frog":"Frog","legomario.pants.tanooki":"Tanooki","legomario.pants.propeller":"Propeller","legomario.pants.cat":"Cat","legomario.pants.fire":"Fire","legomario.pants.penguin":"Penguin","legomario.pants.mario":"Mario","legomario.pants.builder":"Builder"},"zh-cn":{"legomario.whenBarcode":"当条形码是[BARCODE]","legomario.whenAnyBarcode":"当扫描到任意条形码","legomario.getBarcode":"条形码","legomario.whenColor":"当颜色是[SENSOR_COLOR]","legomario.isColor":"颜色是[SENSOR_COLOR]?","legomario.getColor":"颜色","legomario.whenPants":"当服装是[PANTS]","legomario.isPants":"服装是[PANTS]?","legomario.getPants":"服装","legomario.color.white":"白色","legomario.color.red":"红色","legomario.color.blue":"蓝色","legomario.color.yellow":"黄色","legomario.color.black":"黑色","legomario.color.green":"绿色","legomario.color.brown":"棕色","legomario.color.purple":"紫色","legomario.color.nougatBrown":"淡棕色","legomario.color.cyan":"青色","legomario.color.noColor":"无色","legomario.pants.none":"无","legomario.pants.bee":"蜜蜂","legomario.pants.luigi":"路易吉","legomario.pants.frog":"青蛙","legomario.pants.tanooki":"狸猫","legomario.pants.propeller":"螺旋桨","legomario.pants.cat":"猫咪","legomario.pants.fire":"火焰","legomario.pants.penguin":"企鹅","legomario.pants.mario":"马力欧","legomario.pants.builder":"建筑工"},"zh-tw":{"legomario.whenBarcode":"當條形碼是[BARCODE]","legomario.whenAnyBarcode":"當掃描到任意條形碼","legomario.getBarcode":"條形碼","legomario.whenColor":"當顏色是[SENSOR_COLOR]","legomario.isColor":"顏色是[SENSOR_COLOR]?","legomario.getColor":"顏色","legomario.whenPants":"當服裝是[PANTS]","legomario.isPants":"服裝是[PANTS]?","legomario.getPants":"服裝","legomario.color.white":"白色","legomario.color.red":"紅色","legomario.color.blue":"藍色","legomario.color.yellow":"黃色","legomario.color.black":"黑色","legomario.color.green":"綠色","legomario.color.brown":"棕色","legomario.color.purple":"紫色","legomario.color.nougatBrown":"淡棕色","legomario.color.cyan":"青色","legomario.color.noColor":"無色","legomario.pants.none":"無","legomario.pants.bee":"蜜蜂","legomario.pants.luigi":"路易吉","legomario.pants.frog":"青蛙","legomario.pants.tanooki":"貍貓","legomario.pants.propeller":"螺旋槳","legomario.pants.cat":"貓咪","legomario.pants.fire":"火焰","legomario.pants.penguin":"企鵝","legomario.pants.mario":"瑪利歐","legomario.pants.builder":"建築工"}})}();