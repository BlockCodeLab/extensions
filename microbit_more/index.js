!function(){const t=Scratch.ArgumentType,i=Scratch.BlockType,n=Scratch.Base64Util,o=Scratch.formatMessage,r=Scratch.Cast,s=Scratch.log,a=Scratch.BLE,u={MICROBIT_V1:1,MICROBIT_V2:2},l={BLE:0,SERIAL:1},c={CMD_CONFIG:0,CMD_PIN:1,CMD_DISPLAY:2,CMD_AUDIO:3,CMD_DATA:4},d={SET_OUTPUT:1,SET_PWM:2,SET_SERVO:3,SET_PULL:4,SET_EVENT:5},p={CLEAR:0,TEXT:1,PIXELS_0:2,PIXELS_1:3},h={NONE:"NONE",DOWN:"DOWN",UP:"UP"},m={NONE:0,DOWN:1,UP:2},M={CONFIG:16,PIN_EVENT:17,ACTION_EVENT:18,DATA_NUMBER:19,DATA_TEXT:20},E={BUTTON:1,GESTURE:2},b={INPUT:"INPUT",OUTPUT:"OUTPUT",PWM:"PWM",SERVO:"SERVO",TOUCH:"TOUCH"},g={P0:"P0",P1:"P1",P2:"P2",A:"A",B:"B",LOGO:"LOGO"},T={1:"A",2:"B",100:"P0",101:"P1",102:"P2",121:"LOGO"},v={P0:0,P1:1,P2:2},f={P0:0,P1:1,P2:2,A:3,B:4,LOGO:5},A={DOWN:"DOWN",UP:"UP",CLICK:"CLICK",LONG_CLICK:"LONG_CLICK",HOLD:"HOLD",DOUBLE_CLICK:"DOUBLE_CLICK"},N={1:"DOWN",2:"UP",3:"CLICK",4:"LONG_CLICK",5:"HOLD",6:"DOUBLE_CLICK"},P={TILT_UP:"TILT_UP",TILT_DOWN:"TILT_DOWN",TILT_LEFT:"TILT_LEFT",TILT_RIGHT:"TILT_RIGHT",FACE_UP:"FACE_UP",FACE_DOWN:"FACE_DOWN",FREEFALL:"FREEFALL",G3:"G3",G6:"G6",G8:"G8",SHAKE:"SHAKE"},I={1:"TILT_UP",2:"TILT_DOWN",3:"TILT_LEFT",4:"TILT_RIGHT",5:"FACE_UP",6:"FACE_DOWN",7:"FREEFALL",8:"G3",9:"G6",10:"G8",11:"SHAKE"},L={NONE:0,ON_EDGE:1,ON_PULSE:2,ON_TOUCH:3},D={RISE:2,FALL:3,PULSE_HIGH:4,PULSE_LOW:5},y={NUMBER:1,TEXT:2},_={MIC:1,TOUCH:2},O={STOP_TONE:0,PLAY_TONE:1},w={NAME_PREFIX:"BBC micro:bit",ID:"0b50f3e4-607f-4151-9091-7d008d6ffc5c",COMMAND_CH:"0b500100-607f-4151-9091-7d008d6ffc5c",STATE_CH:"0b500101-607f-4151-9091-7d008d6ffc5c",MOTION_CH:"0b500102-607f-4151-9091-7d008d6ffc5c",PIN_EVENT_CH:"0b500110-607f-4151-9091-7d008d6ffc5c",ACTION_EVENT_CH:"0b500111-607f-4151-9091-7d008d6ffc5c",ANALOG_IN_CH:["0b500120-607f-4151-9091-7d008d6ffc5c","0b500121-607f-4151-9091-7d008d6ffc5c","0b500122-607f-4151-9091-7d008d6ffc5c"],MESSAGE_CH:"0b500130-607f-4151-9091-7d008d6ffc5c"},S={X:"x",Y:"y",Z:"z",Absolute:"absolute"},U=1024;class e{constructor(e,t){this.runtime=e,this._ble=null,this.runtime.registerPeripheralExtension(t,this),this._extensionId=t,this.digitalLevel={},this.lightLevel=0,this.temperature=0,this.soundLevel=0,this.pitch=0,this.roll=0,this.acceleration={x:0,y:0,z:0},this.compassHeading=0,this.magneticForce={x:0,y:0,z:0},this.buttonState={},this.buttonEvents={},Object.keys(f).forEach(e=>{this.buttonEvents[e]={}}),this.gestureEvents={},this._pinEvents={},this.receivedData={},this.analogIn=[0,1,2],this.analogValue=[],this.analogIn.forEach(e=>{this.analogValue[e]=0}),this.gpio=[0,1,2,8,12,13,14,15,16],this.gpio.forEach(e=>{this.digitalLevel[e]=0}),this._timeoutID=null,this.bleBusy=!0,this.bleBusyTimeoutID=null,this.onDisconnect=this.onDisconnect.bind(this),this._onConnect=this._onConnect.bind(this),this.onNotify=this.onNotify.bind(this),this.stopTone=this.stopTone.bind(this),this.runtime&&this.runtime.on("PROJECT_STOP_ALL",this.stopTone),this.analogInUpdateInterval=100,this.analogInLastUpdated=[Date.now(),Date.now(),Date.now()],this.sendCommandInterval=30,this.initConfig(),this.keyState={},document.body.addEventListener("keydown",e=>{this.keyState[e.code]={key:e.key,code:e.code,alt:e.altKey,ctrl:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey}}),document.body.addEventListener("keyup",e=>{delete this.keyState[e.code]})}initConfig(){this.config={},this.config.mic=!1,this.config.pinMode={}}startUpdater(){this.updater&&clearTimeout(this.updater),this.bleAccessWaiting?this.updater=setTimeout(()=>this.startUpdater(),0):this.updateState().then(()=>this.updateMotion()).finally(()=>{this.updater=setTimeout(()=>this.startUpdater(),this.microbitUpdateInterval)})}stopUpdater(){clearTimeout(this.updater)}displayText(t,e,i){var n=Math.min(18,t.length),o=new Uint8Array(n+1);for(let e=0;e<n;e++)o[e]=t.charCodeAt(e);return this.sendCommandSet([{id:c.CMD_DISPLAY<<5|p.TEXT,message:new Uint8Array([Math.min(255,Math.max(0,e)/10),...o])}],i)}displayPixels(e,t){e=[{id:c.CMD_DISPLAY<<5|p.PIXELS_0,message:new Uint8Array([...e[0],...e[1],...e[2]])},{id:c.CMD_DISPLAY<<5|p.PIXELS_1,message:new Uint8Array([...e[3],...e[4]])}];return this.sendCommandSet(e,t)}setPullMode(e,t,i){return this.config.pinMode[e]=b.INPUT,this.sendCommandSet([{id:c.CMD_PIN<<5|d.SET_PULL,message:new Uint8Array([e,t])}],i)}setPinOutput(e,t,i){return this.config.pinMode[e]=b.OUTPUT,this.sendCommandSet([{id:c.CMD_PIN<<5|d.SET_OUTPUT,message:new Uint8Array([e,t?1:0])}],i)}setPinPWM(e,t,i){this.config.pinMode[e]=b.PWM;var n=new DataView(new ArrayBuffer(2));return n.setUint16(0,t,!0),this.sendCommandSet([{id:c.CMD_PIN<<5|d.SET_PWM,message:new Uint8Array([e,n.getUint8(0),n.getUint8(1)])}],i)}setPinServo(e,t,i,n,o){this.config.pinMode[e]=b.SERVO,(!i||i<0)&&(i=0),(!n||n<0)&&(n=0);var r=new DataView(new ArrayBuffer(6));return r.setUint16(0,t,!0),r.setUint16(2,i,!0),r.setUint16(4,n,!0),this.sendCommandSet([{id:c.CMD_PIN<<5|d.SET_SERVO,message:new Uint8Array([e,r.getUint8(0),r.getUint8(1),r.getUint8(2),r.getUint8(3),r.getUint8(4),r.getUint8(5)])}],o)}readLightLevel(){return this.isConnected()?this.lightLevel:0}readAnalogIn(i,e){return this.isConnected()?Date.now()-this.analogInLastUpdated[i]<this.analogInUpdateInterval?Promise.resolve(this.analogValue[i]):this.bleBusy?(this.bleAccessWaiting=!0,void(e&&e.yield())):(this.bleBusy=!0,this.bleBusyTimeoutID=window.setTimeout(()=>{this.bleBusy=!1,this.bleAccessWaiting=!1},1e3),new Promise(t=>this._ble.read(w.ID,w.ANALOG_IN_CH[i],!1).then(e=>{if(window.clearTimeout(this.bleBusyTimeoutID),this.bleBusy=!1,this.bleAccessWaiting=!1,!e)return t(this.analogValue[i]);e=new DataView(e.message.buffer,0);this.analogValue[i]=e.getUint16(0,!0),this.analogInLastUpdated=Date.now(),t(this.analogValue[i])}))):Promise.resolve(0)}updateState(){return!this.isConnected()||this.bleBusy?Promise.resolve(this):(this.bleBusy=!0,this.bleBusyTimeoutID=window.setTimeout(()=>{this.bleBusy=!1},1e3),new Promise(i=>{this._ble.read(w.ID,w.STATE_CH,!1).then(e=>{if(window.clearTimeout(this.bleBusyTimeoutID),this.bleBusy=!1,!e)return i(this);e=new DataView(e.message.buffer,0);const t=e.getUint32(0,!0);for(let e=0;e<this.gpio.length;e++)this.digitalLevel[this.gpio[e]]=t>>this.gpio[e]&1;Object.keys(f).forEach(e=>{this.buttonState[e]=t>>24+f[e]&1}),this.lightLevel=e.getUint8(4),this.temperature=e.getUint8(5)-128,this.soundLevel=e.getUint8(6),this.resetConnectionTimeout(),i(this)})}))}readTemperature(){return this.isConnected()?this.temperature:0}configMic(e,t){return e=!0===e,this.isConnected()?this.config.mic===e?Promise.resolve(this.config.mic):(t=this.sendCommandSet([{id:c.CMD_CONFIG<<5|_.MIC,message:new Uint8Array([e?1:0])}],t))?t.then(()=>(this.config.mic=e,this.config.mic)):void 0:Promise.resolve(!1)}playTone(e,t,i){var n;return this.isConnected()?((n=new DataView(new ArrayBuffer(4))).setUint32(0,Math.round(1e6/e),!0),t=Math.round(255*t/100),this.sendCommandSet([{id:c.CMD_AUDIO<<5|O.PLAY_TONE,message:new Uint8Array([n.getUint8(0),n.getUint8(1),n.getUint8(2),n.getUint8(3),t])}],i)):Promise.resolve()}stopTone(e){return this.isConnected()?this.sendCommandSet([{id:c.CMD_AUDIO<<5|O.STOP_TONE,message:new Uint8Array([])}],e):Promise.resolve()}readSoundLevel(){return this.isConnected()?this.soundLevel:0}updateMotion(){return!this.isConnected()||this.bleBusy?Promise.resolve(this):(this.bleBusy=!0,this.bleBusyTimeoutID=window.setTimeout(()=>{this.bleBusy=!1},1e3),new Promise(t=>{this._ble.read(w.ID,w.MOTION_CH,!1).then(e=>{if(window.clearTimeout(this.bleBusyTimeoutID),this.bleBusy=!1,!e)return t(this);e=new DataView(e.message.buffer,0);this.pitch=Math.round(180*e.getInt16(0,!0)/Math.PI/1e3),this.roll=Math.round(180*e.getInt16(2,!0)/Math.PI/1e3),this.acceleration.x=1e3*e.getInt16(4,!0)/U,this.acceleration.y=1e3*e.getInt16(6,!0)/U,this.acceleration.z=1e3*e.getInt16(8,!0)/U,this.compassHeading=e.getUint16(10,!0),this.magneticForce.x=e.getInt16(12,!0),this.magneticForce.y=e.getInt16(14,!0),this.magneticForce.z=e.getInt16(16,!0),this.resetConnectionTimeout(),t(this)})}))}readPitch(){return this.isConnected()?this.pitch:0}readRoll(){return this.isConnected()?this.roll:0}readAcceleration(e){return this.isConnected()?e===S.Absolute?Math.round(Math.sqrt(this.acceleration.x**2+this.acceleration.y**2+this.acceleration.z**2)):this.acceleration[e]:0}readCompassHeading(){return this.isConnected()?this.compassHeading:0}readMagneticForce(e){return this.isConnected()?e===S.Absolute?Math.round(Math.sqrt(this.magneticForce.x**2+this.magneticForce.y**2+this.magneticForce.z**2)):this.magneticForce[e]:0}scan(){var e=a;this._ble=new e(this.runtime,this._extensionId,{filters:[{namePrefix:"BBC micro:bit"},{services:[w.ID]}]},this._onConnect,this.onDisconnect)}isKeyPressing(t){return Object.values(this.keyState).find(e=>e.key===t)}scan(){this._ble&&this._ble.disconnect(),this._ble=new a(this.runtime,this._extensionId,{filters:[{namePrefix:w.NAME_PREFIX},{services:[w.ID]}]},this._onConnect,this.onDisconnect),this.keyState={}}connect(e){this._ble&&this._ble.connectPeripheral(e)}disconnect(){this._ble&&this._ble.disconnect(),this.onDisconnect()}onDisconnect(){this.stopUpdater(),this._timeoutID&&(window.clearTimeout(this._timeoutID),this._timeoutID=null)}isConnected(){let e=!1;return e=this._ble?this._ble.isConnected():e}sendCommand(e){const t=n.uint8ArrayToBase64(new Uint8Array([e.id,...e.message]));return new Promise(e=>{this._ble.write(w.ID,w.COMMAND_CH,t,"base64",!1),setTimeout(()=>e(),this.sendCommandInterval)})}sendCommandSet(t,e){return this.isConnected()?this.bleBusy?(this.bleAccessWaiting=!0,void(e?e.yield():setTimeout(()=>this.sendCommandSet(t,e),1))):(this.bleBusy=!0,this.bleBusyTimeoutID=window.setTimeout(()=>{this.bleBusy=!1,this.bleAccessWaiting=!1},1e3),new Promise(e=>{t.reduce((e,t)=>e.then(()=>this.sendCommand(t)),Promise.resolve()).then(()=>{window.clearTimeout(this.bleBusyTimeoutID)}).catch(e=>{s.log(e),this._ble.handleDisconnectError(e)}).finally(()=>{this.bleBusy=!1,this.bleAccessWaiting=!1,e()})})):Promise.resolve()}_onConnect(){this._ble.read(w.ID,w.COMMAND_CH,!1).then(e=>{if(!e)throw new Error("Config is not readable");e=new DataView(e.message.buffer,0);this.hardware=e.getUint8(0),this.protocol=e.getUint8(1),this.route=e.getUint8(2),this._ble.startNotifications(w.ID,w.ACTION_EVENT_CH,this.onNotify),this._ble.startNotifications(w.ID,w.PIN_EVENT_CH,this.onNotify),this.hardware===u.MICROBIT_V1?this.microbitUpdateInterval=100:(this._ble.startNotifications(w.ID,w.MESSAGE_CH,this.onNotify),this.microbitUpdateInterval=50),this.route===l.SERIAL?this.sendCommandInterval=100:this.sendCommandInterval=30,this.initConfig(),this.bleBusy=!1,this.startUpdater(),this.resetConnectionTimeout()}).catch(e=>this._ble.handleDisconnectError(e))}onNotify(e){var t,i,n,o=new DataView(e.buffer,0),r=o.getUint8(19);r===M.ACTION_EVENT?(t=o.getUint8(0))===E.BUTTON?(i=T[o.getUint16(1,!0)],n=N[o.getUint8(3)],this.buttonEvents[i][n]=o.getUint32(4,!0)):t===E.GESTURE&&(i=I[o.getUint8(1)],this.gestureEvents[i]=o.getUint32(2,!0)):r===M.PIN_EVENT?(n=o.getUint8(0),this._pinEvents[n]||(this._pinEvents[n]={}),t=o.getUint8(1),this._pinEvents[n][t]={value:o.getUint32(2,!0),timestamp:Date.now()}):r===M.DATA_NUMBER?(i=(new TextDecoder).decode(e.slice(0,8).filter(e=>0!==e)),this.receivedData[i]={content:o.getFloat32(8,!0),timestamp:Date.now()}):r===M.DATA_TEXT&&(n=(new TextDecoder).decode(e.slice(0,8).filter(e=>0!==e)),this.receivedData[n]={content:(new TextDecoder).decode(e.slice(8,20).filter(e=>0!==e)),timestamp:Date.now()}),this.resetConnectionTimeout()}resetConnectionTimeout(){this._timeoutID&&window.clearTimeout(this._timeoutID),this._timeoutID=window.setTimeout(()=>this._ble.handleDisconnectError("micro:bit extension stopped receiving data"),4500)}isPinHigh(e){return 1===this.readDigitalLevel(e)}readDigitalLevel(e){return this.isConnected()?this.digitalLevel[e]:0}isButtonPressed(e){return!!this.isConnected()&&1===this.buttonState[e]}isPinTouchMode(e){return this.config.pinMode[e]===b.TOUCH}configTouchPin(e,t){return!this.isConnected()||this.isPinTouchMode(e)?Promise.resolve():(t=this.sendCommandSet([{id:c.CMD_CONFIG<<5|_.TOUCH,message:new Uint8Array([e,1])}],t))?t.then(()=>{this.config.pinMode[e]=b.TOUCH}):void 0}isTouched(e){return!!this.isConnected()&&1===this.buttonState[e]}getButtonEventTimestamp(e,t){return this.buttonEvents[e]&&this.buttonEvents[e][t]?this.buttonEvents[e][t]:null}getGestureEventTimestamp(e){return this.gestureEvents[e]||null}getPinEventValue(e,t){return this._pinEvents[e]&&this._pinEvents[e][t]?this._pinEvents[e][t].value:null}getPinEventTimestamp(e,t){return this._pinEvents[e]&&this._pinEvents[e][t]?this._pinEvents[e][t].timestamp:null}listenPinEventType(e,t,i){return this.sendCommandSet([{id:c.CMD_PIN<<5|d.SET_EVENT,message:new Uint8Array([e,t])}],i)}sendData(i,e,t){var n=new Array(8).fill().map((e,t)=>i.charCodeAt(t)),o=Number(e);let r,s;return r=Number.isNaN(o)?(s=y.TEXT,e.split("").map(e=>e.charCodeAt(0)).slice(0,11)):(s=y.NUMBER,(e=new DataView(new ArrayBuffer(4))).setFloat32(0,o,!0),[e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3)]),this.sendCommandSet([{id:c.CMD_DATA<<5|s,message:new Uint8Array([...n,...r])}],t)}getDataLabeled(e){return this.receivedData[e]?this.receivedData[e].content:null}getDataTimestamp(e){return this.receivedData[e]?this.receivedData[e].timestamp:null}}Scratch.extensions.register(new class C{static get EXTENSION_NAME(){return"micro:bit more"}static get EXTENSION_ID(){return"microbitMore"}get GESTURES_MENU(){return[{text:o({id:"microbitMore.gesturesMenu.tiltUp",default:"tilt up",description:"label for tilt up gesture in gesture picker for microbit more extension"}),value:P.TILT_UP},{text:o({id:"microbitMore.gesturesMenu.tiltDown",default:"tilt down",description:"label for tilt down gesture in gesture picker for microbit more extension"}),value:P.TILT_DOWN},{text:o({id:"microbitMore.gesturesMenu.tiltLeft",default:"tilt left",description:"label for tilt left gesture in gesture picker for microbit more extension"}),value:P.TILT_LEFT},{text:o({id:"microbitMore.gesturesMenu.tiltRight",default:"tilt right",description:"label for tilt right gesture in gesture picker for microbit more extension"}),value:P.TILT_RIGHT},{text:o({id:"microbitMore.gesturesMenu.faceUp",default:"face up",description:"label for face up gesture in gesture picker for microbit more extension"}),value:P.FACE_UP},{text:o({id:"microbitMore.gesturesMenu.faceDown",default:"face down",description:"label for face down gesture in gesture picker for microbit more extension"}),value:P.FACE_DOWN},{text:o({id:"microbitMore.gesturesMenu.freefall",default:"freefall",description:"label for freefall gesture in gesture picker for microbit more extension"}),value:P.FREEFALL},{text:o({id:"microbitMore.gesturesMenu.g3",default:"3G",description:"label for 3G gesture in gesture picker for microbit more extension"}),value:P.G3},{text:o({id:"microbitMore.gesturesMenu.g6",default:"6G",description:"label for 6G gesture in gesture picker for microbit more extension"}),value:P.G6},{text:o({id:"microbitMore.gesturesMenu.g8",default:"8G",description:"label for 3G gesture in gesture picker for microbit more extension"}),value:P.G8},{text:o({id:"microbitMore.gesturesMenu.shake",default:"shake",description:"label for shaken gesture in gesture picker for microbit more extension"}),value:P.SHAKE}]}get BUTTON_ID_MENU(){return[{text:o({id:"microbitMore.buttonIDMenu.a",default:"A",description:'label for "A" element in button picker for Microbit More extension'}),value:g.A},{text:o({id:"microbitMore.buttonIDMenu.b",default:"B",description:'label for "B" element in button picker for Microbit More extension'}),value:g.B}]}get BUTTON_EVENT_MENU(){return[{text:o({id:"microbitMore.buttonEventMenu.down",default:"down",description:"label for button down event"}),value:A.DOWN},{text:o({id:"microbitMore.buttonEventMenu.up",default:"up",description:"label for button up event"}),value:A.UP},{text:o({id:"microbitMore.buttonEventMenu.click",default:"click",description:"label for button click event"}),value:A.CLICK}]}get TOUCH_ID_MENU(){return[{text:o({id:"microbitMore.touchIDMenu.logo",default:"LOGO",description:'label for "LOGO" element in touch button picker for Microbit More extension'}),value:g.LOGO},{text:"P0",value:g.P0},{text:"P1",value:g.P1},{text:"P2",value:g.P2}]}get TOUCH_EVENT_MENU(){return[{text:o({id:"microbitMore.touchEventMenu.touched",default:"touched",description:"label for touched event"}),value:A.DOWN},{text:o({id:"microbitMore.touchEventMenu.released",default:"released",description:"label for released event"}),value:A.UP},{text:o({id:"microbitMore.touchEventMenu.tapped",default:"tapped",description:"label for tapped event"}),value:A.CLICK}]}get ANALOG_IN_PINS_MENU(){return this._peripheral.analogIn.map(e=>Object.create({text:"P"+e.toString(),value:e.toString()}))}get GPIO_MENU(){return this._peripheral.gpio.map(e=>Object.create({text:"P"+e.toString(),value:e.toString()}))}get DIGITAL_VALUE_MENU(){return[{text:o({id:"microbitMore.digitalValueMenu.Low",default:"Low",description:"label for low value in digital output menu for microbit more extension"}),value:"false"},{text:o({id:"microbitMore.digitalValueMenu.High",default:"High",description:"label for high value in digital output menu for microbit more extension"}),value:"true"}]}get AXIS_MENU(){return[{text:o({id:"microbitMore.axisMenu.x",default:"x",description:"label of X axis."}),value:S.X},{text:o({id:"microbitMore.axisMenu.y",default:"y",description:"label of Y axis."}),value:S.Y},{text:o({id:"microbitMore.axisMenu.z",default:"z",description:"label of Z axis."}),value:S.Z},{text:o({id:"microbitMore.axisMenu.absolute",default:"absolute",description:"label of absolute value."}),value:S.Absolute}]}get PIN_MODE_MENU(){return[{text:o({id:"microbitMore.pinModeMenu.pullNone",default:"pull none",description:"label for pullNone mode"}),value:h.NONE},{text:o({id:"microbitMore.pinModeMenu.pullUp",default:"pull up",description:"label for pullUp mode"}),value:h.UP},{text:o({id:"microbitMore.pinModeMenu.pullDown",default:"pull down",description:"label for pullDown mode"}),value:h.DOWN}]}get PIN_EVENT_MENU(){return[{text:o({id:"microbitMore.pinEventMenu.pulseLow",default:"low pulse",description:"label for low pulse event"}),value:"PULSE_LOW"},{text:o({id:"microbitMore.pinEventMenu.pulseHigh",default:"high pulse",description:"label for high pulse event"}),value:"PULSE_HIGH"},{text:o({id:"microbitMore.pinEventMenu.fall",default:"fall",description:"label for fall event"}),value:"FALL"},{text:o({id:"microbitMore.pinEventMenu.rise",default:"rise",description:"label for rise event"}),value:"RISE"}]}get PIN_EVENT_TIMESTAMP_MENU(){return[{text:o({id:"microbitMore.pinEventTimestampMenu.pulseLow",default:"low pulse",description:"label for low pulse event"}),value:"PULSE_LOW"},{text:o({id:"microbitMore.pinEventTimestampMenu.pulseHigh",default:"high pulse",description:"label for high pulse event"}),value:"PULSE_HIGH"},{text:o({id:"microbitMore.pinEventTimestampMenu.fall",default:"fall",description:"label for fall event"}),value:"FALL"},{text:o({id:"microbitMore.pinEventTimestampMenu.rise",default:"rise",description:"label for rise event"}),value:"RISE"}]}get PIN_EVENT_TYPE_MENU(){return[{text:o({id:"microbitMore.pinEventTypeMenu.none",default:"none",description:"label for remove event listener"}),value:"NONE"},{text:o({id:"microbitMore.pinEventTypeMenu.pulse",default:"pulse",description:"label for pulse event type"}),value:"ON_PULSE"},{text:o({id:"microbitMore.pinEventTypeMenu.edge",default:"edge",description:"label for edge event type"}),value:"ON_EDGE"}]}get CONNECTION_STATE_MENU(){return[{text:o({id:"microbitMore.connectionStateMenu.connected",default:"connected",description:"label for connected"}),value:"connected"},{text:o({id:"microbitMore.connectionStateMenu.disconnected",default:"disconnected",description:"label for disconnected"}),value:"disconnected"}]}constructor(){this.runtime=Scratch.vm.runtime,this._peripheral=new e(this.runtime,C.EXTENSION_ID),this.prevButtonEvents={},this.prevGestureEvents={},this.prevPinEvents={},this.prevReceivedData={}}getInfo(){var e=o.setup().locale;return{id:C.EXTENSION_ID,name:C.EXTENSION_NAME,blockIconURI:"data:image/png;base64,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",showStatusButton:!0,docsURI:Scratch.require.resolve(`readme.${e}.html`),blocks:[{opcode:"whenConnectionChanged",text:o({id:"microbitMore.whenConnectionChanged",default:"when micro:bit [STATE]",description:"when a micro:bit connection state changed"}),blockType:i.HAT,arguments:{STATE:{type:t.STRING,menu:"connectionStateMenu",defaultValue:"connected"}}},"---",{opcode:"whenButtonEvent",text:o({id:"microbitMore.whenButtonEvent",default:"when button [NAME] is [EVENT]",description:"when the selected button on the micro:bit get the selected event"}),blockType:i.HAT,arguments:{NAME:{type:t.STRING,menu:"buttonIDMenu",defaultValue:g.A},EVENT:{type:t.STRING,menu:"buttonEventMenu",defaultValue:A.DOWN}}},{opcode:"isButtonPressed",text:o({id:"microbitMore.isButtonPressed",default:"button [NAME] pressed?",description:"is the selected button on the micro:bit pressed?"}),blockType:i.BOOLEAN,arguments:{NAME:{type:t.STRING,menu:"buttonIDMenu",defaultValue:g.A}}},{opcode:"whenTouchEvent",text:o({id:"microbitMore.whenTouchEvent",default:"when pin [NAME] is [EVENT]",description:"when the selected touch pin on the micro:bit is touched"}),blockType:i.HAT,arguments:{NAME:{type:t.STRING,menu:"touchIDMenu",defaultValue:g.LOGO},EVENT:{type:t.STRING,menu:"touchEventMenu",defaultValue:A.DOWN}}},{opcode:"isPinTouched",text:o({id:"microbitMore.isPinTouched",default:"pin [NAME] is touched?",description:"is the selected pin is touched?"}),blockType:i.BOOLEAN,arguments:{NAME:{type:t.STRING,menu:"touchIDMenu",defaultValue:g.LOGO}}},"---",{opcode:"whenGesture",text:o({id:"microbitMore.whenGesture",default:"when [GESTURE]",description:"when the selected gesture is detected by the micro:bit"}),blockType:i.HAT,arguments:{GESTURE:{type:t.STRING,menu:"gestures",defaultValue:P.SHAKE}}},"---",{opcode:"displayMatrix",text:o({id:"microbitMore.displayMatrix",default:"display pattern [MATRIX] ",description:"display a pattern on the micro:bit display"}),blockType:i.COMMAND,arguments:{MATRIX:{type:t.MATRIX,defaultValue:"0101010101100010101000100"}}},{opcode:"displayText",text:o({id:"microbitMore.displayText",default:"display text [TEXT] delay [DELAY] ms",description:"display text on the micro:bit display"}),blockType:i.COMMAND,arguments:{TEXT:{type:t.STRING,defaultValue:"Hello!"},DELAY:{type:t.NUMBER,defaultValue:120}}},{opcode:"displayClear",text:o({id:"microbitMore.clearDisplay",default:"clear display",description:"display nothing on the micro:bit display"}),blockType:i.COMMAND},"---",{opcode:"getLightLevel",text:o({id:"microbitMore.lightLevel",default:"light intensity",description:"how much the amount of light falling on the LEDs on micro:bit"}),blockType:i.REPORTER},{opcode:"getTemperature",text:o({id:"microbitMore.temperature",default:"temperature",description:"temperature (celsius) on the surface of CPU of micro:bit"}),blockType:i.REPORTER},{opcode:"getCompassHeading",text:o({id:"microbitMore.compassHeading",default:"angle with the North",description:"angle from the North to the micro:bit heading direction"}),blockType:i.REPORTER},{opcode:"getPitch",text:o({id:"microbitMore.pitch",default:"pitch",description:"nose up movement of the micro:bit from level"}),blockType:i.REPORTER},{opcode:"getRoll",text:o({id:"microbitMore.roll",default:"roll",description:"clockwise circular movement of the micro:bit from level"}),blockType:i.REPORTER},{opcode:"getSoundLevel",text:o({id:"microbitMore.soundLevel",default:"sound level",description:"level of the sound from microphone on micro:bit"}),blockType:i.REPORTER},{opcode:"getMagneticForce",text:o({id:"microbitMore.magneticForce",default:"magnetic force",description:"value of magnetic force (micro tesla)"}),blockType:i.REPORTER,arguments:{AXIS:{type:t.STRING,menu:"axis",defaultValue:S.Absolute}}},{opcode:"getAcceleration",text:o({id:"microbitMore.acceleration",default:"acceleration [AXIS]",description:"value of acceleration on the axis (milli-g)"}),blockType:i.REPORTER,arguments:{AXIS:{type:t.STRING,menu:"axis",defaultValue:S.X}}},"---",{opcode:"getAnalogValue",text:o({id:"microbitMore.analogValue",default:"analog value of pin [PIN]",description:"analog input value of the pin"}),blockType:i.REPORTER,arguments:{PIN:{type:t.STRING,menu:"analogInPins",defaultValue:"0"}}},{opcode:"setPullMode",text:o({id:"microbitMore.setPullMode",default:"set pin [PIN] to input [MODE]",description:"set a pin into the mode"}),blockType:i.COMMAND,arguments:{PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"},MODE:{type:t.STRING,menu:"pinMode",defaultValue:h.UP}}},{opcode:"isPinHigh",text:o({id:"microbitMore.isPinHigh",default:"[PIN] pin is high?",description:"is the selected pin high as digital?"}),blockType:i.BOOLEAN,arguments:{PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"}}},"---",{opcode:"setDigitalOut",text:o({id:"microbitMore.setDigitalOut",default:"set [PIN] Digital [LEVEL]",description:"set pin to Digital Output mode and the level(High = true)"}),blockType:i.COMMAND,arguments:{PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"},LEVEL:{type:t.STRING,menu:"digitalValueMenu",defaultValue:"false"}}},{opcode:"setAnalogOut",text:o({id:"microbitMore.setAnalogOut",default:"set [PIN] analog [LEVEL] %",description:"set pin to PWM mode and the level(0 to 1023)"}),blockType:i.COMMAND,arguments:{PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"},LEVEL:{type:t.NUMBER,defaultValue:0}}},{opcode:"setServo",text:o({id:"microbitMore.setServo",default:"set [PIN] Servo [ANGLE]",description:"set pin to Servo mode and the angle(0 to 180)"}),blockType:i.COMMAND,arguments:{PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"},ANGLE:{type:t.NUMBER,defaultValue:0},RANGE:{type:t.NUMBER,defaultValue:2e3},CENTER:{type:t.NUMBER,defaultValue:1500}}},{opcode:"playTone",text:o({id:"microbitMore.playTone",default:"play tone [FREQ] Hz volume [VOL] %",description:"play tone on the speaker"}),blockType:i.COMMAND,arguments:{FREQ:{type:t.NUMBER,defaultValue:440},VOL:{type:t.NUMBER,defaultValue:100}}},{opcode:"stopTone",text:o({id:"microbitMore.stopTone",default:"stop tone",description:"stop tone on the speaker"}),blockType:i.COMMAND},"---",{opcode:"listenPinEventType",text:o({id:"microbitMore.listenPinEventType",default:"listen [EVENT_TYPE] event on [PIN]",description:"listen the event on the pin"}),blockType:i.COMMAND,arguments:{EVENT_TYPE:{type:t.STRING,menu:"pinEventTypeMenu",defaultValue:"NONE"},PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"}}},{opcode:"whenPinEvent",text:o({id:"microbitMore.whenPinEvent",default:"when catch [EVENT] at pin [PIN]",description:"when catch the event at the pin"}),blockType:i.HAT,arguments:{EVENT:{type:t.STRING,menu:"pinEventMenu",defaultValue:"PULSE_LOW"},PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"}}},{opcode:"getPinEventValue",text:o({id:"microbitMore.getPinEventValue",default:"value of [EVENT] at [PIN]",description:"value of the value of the event (timestamp of the edge or duration of the pulse)"}),blockType:i.REPORTER,arguments:{EVENT:{type:t.STRING,menu:"pinEventTimestampMenu",defaultValue:"PULSE_LOW"},PIN:{type:t.STRING,menu:"gpio",defaultValue:"0"}}},"---",{opcode:"whenDataReceived",text:o({id:"microbitMore.whenDataReceived",default:"when data with label [LABEL] received from micro:bit",description:"when the data which has the label received"}),blockType:i.HAT,arguments:{LABEL:{type:t.STRING,defaultValue:o({id:"microbitMore.sendData.label",default:"label"})}}},{opcode:"getDataLabeled",text:o({id:"microbitMore.getDataLabeled",default:"data of label [LABEL]",description:"the last data which has the label"}),blockType:i.REPORTER,arguments:{LABEL:{type:t.STRING,defaultValue:o({id:"microbitMore.sendData.label",default:"label"})}}},{opcode:"sendData",text:o({id:"microbitMore.sendData",default:"send data [DATA] with label [LABEL] to micro:bit",description:"send data content with label to micro:bit"}),blockType:i.COMMAND,arguments:{LABEL:{type:t.STRING,defaultValue:o({id:"microbitMore.sendData.label",default:"label"})},DATA:{type:t.STRING,defaultValue:o({id:"microbitMore.sendData.data",default:"data"})}}}],menus:{buttonIDMenu:{acceptReporters:!1,items:this.BUTTON_ID_MENU},buttonEventMenu:{acceptReporters:!1,items:this.BUTTON_EVENT_MENU},touchIDMenu:{acceptReporters:!1,items:this.TOUCH_ID_MENU},touchEventMenu:{acceptReporters:!1,items:this.TOUCH_EVENT_MENU},gestures:{acceptReporters:!1,items:this.GESTURES_MENU},analogInPins:{acceptReporters:!1,items:this.ANALOG_IN_PINS_MENU},digitalValueMenu:{acceptReporters:!0,items:this.DIGITAL_VALUE_MENU},gpio:{acceptReporters:!1,items:this.GPIO_MENU},axis:{acceptReporters:!1,items:this.AXIS_MENU},pinMode:{acceptReporters:!1,items:this.PIN_MODE_MENU},pinEventTypeMenu:{acceptReporters:!1,items:this.PIN_EVENT_TYPE_MENU},pinEventMenu:{acceptReporters:!1,items:this.PIN_EVENT_MENU},pinEventTimestampMenu:{acceptReporters:!1,items:this.PIN_EVENT_TIMESTAMP_MENU},connectionStateMenu:{acceptReporters:!1,items:this.CONNECTION_STATE_MENU}}}}updatePrevButtonEvents(){this.prevButtonEvents={},Object.entries(this._peripheral.buttonEvents).forEach(([i,e])=>{this.prevButtonEvents[i]={},Object.entries(e).forEach(([e,t])=>{this.prevButtonEvents[i][e]=t})})}whenButtonEvent(e){this.updateLastButtonEventTimer||(this.updateLastButtonEventTimer=setTimeout(()=>{this.updatePrevButtonEvents(),this.updateLastButtonEventTimer=null},this.runtime.currentStepTime));var t=e.NAME,e=e.EVENT,i=this._peripheral.getButtonEventTimestamp(t,e);return null!==i&&(!this.prevButtonEvents[t]||i!==this.prevButtonEvents[t][e])}isButtonPressed(e){return e=e.NAME,this._peripheral.isButtonPressed(e)}whenTouchEvent(e,t){var i=e.NAME;return i===g.LOGO||this._peripheral.isPinTouchMode(v[i])?this.whenButtonEvent(e):(i=this._peripheral.configTouchPin(v[i],t))?i.then(()=>this.whenButtonEvent(e)):void 0}isPinTouched(e,t){const i=e.NAME;return i===g.LOGO||this._peripheral.isPinTouchMode(v[i])?this._peripheral.isTouched(i):(e=this._peripheral.configTouchPin(v[i],t))?e.then(()=>this._peripheral.isTouched(i)):void 0}updatePrevGestureEvents(){this.prevGestureEvents={},Object.entries(this._peripheral.gestureEvents).forEach(([e,t])=>{this.prevGestureEvents[e]=t})}whenGesture(e){this.updateLastGestureEventTimer||(this.updateLastGestureEventTimer=setTimeout(()=>{this.updatePrevGestureEvents(),this.updateLastGestureEventTimer=null},this.runtime.currentStepTime));var e=e.GESTURE,t=this._peripheral.getGestureEventTimestamp(e);return null!==t&&(!this.prevGestureEvents[e]||t!==this.prevGestureEvents[e])}displayMatrix(e,t){e=r.toString(e.MATRIX).replace(/:/g,"").replace(/[０-９，]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248));let i;i=(i=e.includes(",")?e.split(/[,\n]/):/[ \t]\d*[ \t]/g.test(e)?e.split(/\s/g):(i=e.replace(/\s/g,"").split("")).map(e=>"0"===e?0:100)).map(e=>Math.max(0,255*Math.min(100,Number(e))/100));var n=[];for(let t=0;t<5;t++){n[t]=[];for(let e=0;e<5;e++)n[t][e]=i[5*t+e]}return this._peripheral.displayPixels(n,t)}displayText(e,t){var i=r.toString(e.TEXT).replace(/[Ａ-Ｚａ-ｚ０-９！-～]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/”/g,'"').replace(/’/g,"'").replace(/‘/g,"`").replace(/￥/g,"\\").replace(/　/g," ").replace(/〜/g,"~"),e=parseInt(e.DELAY,10),e=isNaN(e)?120:e;if(this._peripheral.displayText(i,e,t)){const n=e*(6*i.length+6);return new Promise(e=>{setTimeout(()=>{e()},n)})}}displayClear(e,t){return this._peripheral.displayPixels([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],t)}isPinHigh(e){return this._peripheral.isPinHigh(parseInt(e.PIN,10))}getLightLevel(){var e=this._peripheral.readLightLevel();return Math.round(1e3*e/255)/10}getTemperature(){return this._peripheral.readTemperature()}getSoundLevel(e,t){if(t=this._peripheral.configMic(!0,t))return t.then(e=>e?Math.round(1e3*this._peripheral.readSoundLevel()/255)/10:0)}getCompassHeading(){return this._peripheral.readCompassHeading()}getAnalogValue(e,t){if(e=parseInt(e.PIN,10),e=this._peripheral.readAnalogIn(e,t))return e.then(e=>Math.round(100*e*10/1024)/10)}getDigitalValue(e){return this._peripheral.readDigitalLevel(parseInt(e.PIN,10))}sendData(e,t){if(!(e.LABEL.length<=0))return this._peripheral.sendData(e.LABEL,e.DATA,t)}setPullMode(e,t){return this._peripheral.setPullMode(parseInt(e.PIN,10),m[e.MODE],t)}setDigitalOut(e,t){let i=!0===e.LEVEL;var n;return(i=i||"true"===e.LEVEL)||(n=Number(e.LEVEL),isNaN(n))||(i=0<n),this._peripheral.setPinOutput(parseInt(e.PIN,10),i,t)}setAnalogOut(e,t){var i=parseInt(e.LEVEL,10);if(!isNaN(i))return i=Math.max(0,Math.min(i,100)),i=Math.round(1024*i/100),this._peripheral.setPinPWM(parseInt(e.PIN,10),i,t)}setServo(e,t){var i=parseInt(e.ANGLE,10);if(!isNaN(i))return i=Math.max(0,i),i=Math.min(i,180),this._peripheral.setPinServo(parseInt(e.PIN,10),i,null,null,t)}getMagneticForce(e){return this._peripheral.readMagneticForce(e.AXIS)}getAcceleration(e){return this._peripheral.readAcceleration(e.AXIS)}getPitch(){return this._peripheral.readPitch()}getRoll(){return this._peripheral.readRoll()}playTone(e,t){var i=parseFloat(e.FREQ),e=parseInt(e.VOL,10),e=Math.min(100,Math.max(0,e));return this._peripheral.playTone(i,e,t)}stopTone(e,t){return this._peripheral.stopTone(t)}listenPinEventType(e,t){return this._peripheral.listenPinEventType(parseInt(e.PIN,10),L[e.EVENT_TYPE],t)}getPinEventValue(e){return(e=this._peripheral.getPinEventValue(parseInt(e.PIN,10),D[e.EVENT]))||0}updatePrevPinEvents(){this.prevPinEvents={},Object.entries(this._peripheral._pinEvents).forEach(([n,e])=>{this.prevPinEvents[n]={},Object.entries(e).forEach(([i,e])=>{this.prevPinEvents[n][i]={},Object.entries(e).forEach(([e,t])=>{this.prevPinEvents[n][i][e]=t})})})}getPrevPinEventTimestamp(e,t){return this.prevPinEvents[e]&&this.prevPinEvents[e][t]?this.prevPinEvents[e][t].timestamp:null}whenPinEvent(e){this.updateLastPinEventTimer||(this.updateLastPinEventTimer=setTimeout(()=>{this.updatePrevPinEvents(),this.updateLastPinEventTimer=null},this.runtime.currentStepTime));var t=parseInt(e.PIN,10),e=D[e.EVENT],i=this._peripheral.getPinEventTimestamp(t,e);return null!==i&&(null===(t=this.getPrevPinEventTimestamp(t,e))||i!==t)}getDataLabeled(e){return null===(e=this._peripheral.getDataLabeled(e.LABEL))?"":e}updatePrevReceivedData(){this.prevReceivedData={},Object.entries(this._peripheral.receivedData).forEach(([i,e])=>{this.prevReceivedData[i]={},Object.entries(e).forEach(([e,t])=>{this.prevReceivedData[i][e]=t})})}getPrevReceivedDataTimestamp(e){return this.prevReceivedData[e]?this.prevReceivedData[e].timestamp:null}whenDataReceived(e){this.updateLastDataTimer||(this.updateLastDataTimer=setTimeout(()=>{this.updatePrevReceivedData(),this.updateLastDataTimer=null},this.runtime.currentStepTime));var e=e.LABEL,t=this._peripheral.getDataTimestamp(e);return null!==t&&(null===(e=this.getPrevReceivedDataTimestamp(e))||t!==e)}whenConnectionChanged(e){return"connected"===e.STATE===this._peripheral.isConnected()}}),Scratch.extensions.translations({en:{"microbitMore.gesturesMenu.tiltUp":"tilt up","microbitMore.gesturesMenu.tiltDown":"tilt down","microbitMore.gesturesMenu.tiltLeft":"tilt left","microbitMore.gesturesMenu.tiltRight":"tilt right","microbitMore.gesturesMenu.faceUp":"face up","microbitMore.gesturesMenu.faceDown":"face down","microbitMore.gesturesMenu.freefall":"freefall","microbitMore.gesturesMenu.g3":"3G","microbitMore.gesturesMenu.g6":"6G","microbitMore.gesturesMenu.g8":"8G","microbitMore.gesturesMenu.shake":"shake","microbitMore.buttonIDMenu.a":"A","microbitMore.buttonIDMenu.b":"B","microbitMore.buttonEventMenu.down":"down","microbitMore.buttonEventMenu.up":"up","microbitMore.buttonEventMenu.click":"click","microbitMore.touchIDMenu.logo":"LOGO","microbitMore.touchEventMenu.touched":"touched","microbitMore.touchEventMenu.released":"released","microbitMore.touchEventMenu.tapped":"tapped","microbitMore.digitalValueMenu.Low":"low","microbitMore.digitalValueMenu.High":"high","microbitMore.axisMenu.x":"x","microbitMore.axisMenu.y":"y","microbitMore.axisMenu.z":"z","microbitMore.axisMenu.absolute":"absolute","microbitMore.pinModeMenu.pullNone":"pull none","microbitMore.pinModeMenu.pullUp":"pull up","microbitMore.pinModeMenu.pullDown":"pull down","microbitMore.pinEventMenu.pulseLow":"low pulse","microbitMore.pinEventMenu.pulseHigh":"high pulse","microbitMore.pinEventMenu.fall":"fall","microbitMore.pinEventMenu.rise":"rise","microbitMore.pinEventTimestampMenu.pulseLow":"low pulse","microbitMore.pinEventTimestampMenu.pulseHigh":"high pulse","microbitMore.pinEventTimestampMenu.fall":"fall","microbitMore.pinEventTimestampMenu.rise":"rise","microbitMore.pinEventTypeMenu.none":"none","microbitMore.pinEventTypeMenu.pulse":"pulse","microbitMore.pinEventTypeMenu.edge":"edge","microbitMore.connectionStateMenu.connected":"connected","microbitMore.connectionStateMenu.disconnected":"disconnected","microbitMore.whenConnectionChanged":"when micro:bit [STATE]","microbitMore.whenButtonEvent":"when button [NAME] is [EVENT]","microbitMore.isButtonPressed":"button [NAME] pressed?","microbitMore.whenTouchEvent":"when pin [NAME] is [EVENT]","microbitMore.isPinTouched":"pin [NAME] is touched?","microbitMore.whenGesture":"when [GESTURE]","microbitMore.displayMatrix":"display pattern [MATRIX] ","microbitMore.displayText":"display text [TEXT] delay [DELAY] ms","microbitMore.clearDisplay":"clear display","microbitMore.lightLevel":"light intensity","microbitMore.temperature":"temperature","microbitMore.compassHeading":"angle with the north","microbitMore.pitch":"pitch","microbitMore.roll":"roll","microbitMore.soundLevel":"sound level","microbitMore.magneticForce":"magnetic force","microbitMore.acceleration":"acceleration [AXIS]","microbitMore.analogValue":"analog value of pin [PIN]","microbitMore.setPullMode":"set pin [PIN] to input [MODE]","microbitMore.isPinHigh":"[PIN] pin is high?","microbitMore.setDigitalOut":"set [PIN] digital [LEVEL]","microbitMore.setAnalogOut":"set [PIN] analog [LEVEL] %","microbitMore.setServo":"set [PIN] servo angle [ANGLE]","microbitMore.playTone":"play tone [FREQ] Hz volume [VOL] %","microbitMore.stopTone":"stop tone","microbitMore.listenPinEventType":"listen [EVENT_TYPE] event on [PIN]","microbitMore.whenPinEvent":"when catch [EVENT] at pin [PIN]","microbitMore.getPinEventValue":"value of [EVENT] at [PIN]","microbitMore.whenDataReceived":"when data with label [LABEL] received from micro:bit","microbitMore.getDataLabeled":"data of label [LABEL]","microbitMore.sendData":"send data [DATA] with label [LABEL] to micro:bit","microbitMore.sendData.label":"label","microbitMore.sendData.data":"data"},"zh-cn":{"microbitMore.gesturesMenu.tiltUp":"向前倾斜","microbitMore.gesturesMenu.tiltDown":"向后倾斜","microbitMore.gesturesMenu.tiltLeft":"向左倾斜","microbitMore.gesturesMenu.tiltRight":"向右倾斜","microbitMore.gesturesMenu.faceUp":"面朝上","microbitMore.gesturesMenu.faceDown":"面朝下","microbitMore.gesturesMenu.freefall":"自由坠落","microbitMore.gesturesMenu.g3":"3G 加速度","microbitMore.gesturesMenu.g6":"6G 加速度","microbitMore.gesturesMenu.g8":"8G 加速度","microbitMore.gesturesMenu.shake":"摇晃","microbitMore.buttonIDMenu.a":"A","microbitMore.buttonIDMenu.b":"B","microbitMore.buttonEventMenu.down":"按下","microbitMore.buttonEventMenu.up":"松开","microbitMore.buttonEventMenu.click":"点击","microbitMore.touchIDMenu.logo":"徽标","microbitMore.touchEventMenu.touched":"触摸","microbitMore.touchEventMenu.released":"松开","microbitMore.touchEventMenu.tapped":"点击","microbitMore.digitalValueMenu.Low":"低电平","microbitMore.digitalValueMenu.High":"高电平","microbitMore.axisMenu.x":"x","microbitMore.axisMenu.y":"y","microbitMore.axisMenu.z":"z","microbitMore.axisMenu.absolute":"绝对","microbitMore.pinModeMenu.pullNone":"无","microbitMore.pinModeMenu.pullUp":"拉高","microbitMore.pinModeMenu.pullDown":"拉低","microbitMore.pinEventMenu.pulseLow":"低频脉冲","microbitMore.pinEventMenu.pulseHigh":"高频脉冲","microbitMore.pinEventMenu.fall":"下降","microbitMore.pinEventMenu.rise":"上升","microbitMore.pinEventTimestampMenu.pulseLow":"低频脉冲","microbitMore.pinEventTimestampMenu.pulseHigh":"高频脉冲","microbitMore.pinEventTimestampMenu.fall":"下降","microbitMore.pinEventTimestampMenu.rise":"上升","microbitMore.pinEventTypeMenu.none":"无","microbitMore.pinEventTypeMenu.pulse":"脉冲","microbitMore.pinEventTypeMenu.edge":"边缘","microbitMore.connectionStateMenu.connected":"连接","microbitMore.connectionStateMenu.disconnected":"断开","microbitMore.whenConnectionChanged":"当 micro:bit [STATE]","microbitMore.whenButtonEvent":"当按键 [NAME] 被 [EVENT]","microbitMore.isButtonPressed":"按键 [NAME] 按下?","microbitMore.whenTouchEvent":"当引脚 [NAME] 被 [EVENT]","microbitMore.isPinTouched":"引脚 [NAME] 被触摸?","microbitMore.whenGesture":"当 [GESTURE] 时","microbitMore.displayMatrix":"显示图案 [MATRIX] ","microbitMore.displayText":"显示文本 [TEXT] 延时 [DELAY] ms","microbitMore.clearDisplay":"清空屏幕","microbitMore.lightLevel":"亮度级别","microbitMore.temperature":"温度","microbitMore.compassHeading":"指南针面向","microbitMore.pitch":"旋转","microbitMore.roll":"横滚","microbitMore.soundLevel":"声音响度","microbitMore.magneticForce":"磁力","microbitMore.acceleration":"加速度 [AXIS]","microbitMore.analogValue":"引脚 [PIN] 模拟值","microbitMore.setPullMode":"将引脚 [PIN] 输入模式设为 [MODE]","microbitMore.isPinHigh":"引脚 [PIN] 是高电平?","microbitMore.setDigitalOut":"将引脚 [PIN] 数字值设为 [LEVEL]","microbitMore.setAnalogOut":"将引脚 [PIN] 模拟值设为 [LEVEL] %","microbitMore.setServo":"将引脚 [PIN] 舵机角度设为 [ANGLE]","microbitMore.playTone":"播放 [FREQ] Hz 音频并将音量设为 [VOL] %","microbitMore.stopTone":"停止音频","microbitMore.listenPinEventType":"监听引脚 [PIN] 事件 [EVENT_TYPE]","microbitMore.whenPinEvent":"当引脚 [PIN] 发生 [EVENT] 事件","microbitMore.getPinEventValue":"引脚 [PIN] 的 [EVENT] 值","microbitMore.whenDataReceived":"当从 micro:bit 接收到主题为 [LABEL] 的消息","microbitMore.getDataLabeled":"主题为 [LABEL] 的消息内容","microbitMore.sendData":"广播主题为 [LABEL] 的消息 [DATA] 给 micro:bit","microbitMore.sendData.label":"标题","microbitMore.sendData.data":"数据"},"zh-tw":{"microbitMore.gesturesMenu.tiltUp":"向前傾斜","microbitMore.gesturesMenu.tiltDown":"向後傾斜","microbitMore.gesturesMenu.tiltLeft":"向左傾斜","microbitMore.gesturesMenu.tiltRight":"向右傾斜","microbitMore.gesturesMenu.faceUp":"面朝上","microbitMore.gesturesMenu.faceDown":"面朝下","microbitMore.gesturesMenu.freefall":"自由墜落","microbitMore.gesturesMenu.g3":"3G 加速度","microbitMore.gesturesMenu.g6":"6G 加速度","microbitMore.gesturesMenu.g8":"8G 加速度","microbitMore.gesturesMenu.shake":"搖晃","microbitMore.buttonIDMenu.a":"A","microbitMore.buttonIDMenu.b":"B","microbitMore.buttonEventMenu.down":"按下","microbitMore.buttonEventMenu.up":"鬆開","microbitMore.buttonEventMenu.click":"點擊","microbitMore.touchIDMenu.logo":"徽標","microbitMore.touchEventMenu.touched":"觸摸","microbitMore.touchEventMenu.released":"鬆開","microbitMore.touchEventMenu.tapped":"點擊","microbitMore.digitalValueMenu.Low":"低電平","microbitMore.digitalValueMenu.High":"高電平","microbitMore.axisMenu.x":"x","microbitMore.axisMenu.y":"y","microbitMore.axisMenu.z":"z","microbitMore.axisMenu.absolute":"絕對","microbitMore.pinModeMenu.pullNone":"無","microbitMore.pinModeMenu.pullUp":"拉高","microbitMore.pinModeMenu.pullDown":"拉低","microbitMore.pinEventMenu.pulseLow":"低頻脈衝","microbitMore.pinEventMenu.pulseHigh":"高頻脈衝","microbitMore.pinEventMenu.fall":"下降","microbitMore.pinEventMenu.rise":"上升","microbitMore.pinEventTimestampMenu.pulseLow":"低頻脈衝","microbitMore.pinEventTimestampMenu.pulseHigh":"高頻脈衝","microbitMore.pinEventTimestampMenu.fall":"下降","microbitMore.pinEventTimestampMenu.rise":"上升","microbitMore.pinEventTypeMenu.none":"無","microbitMore.pinEventTypeMenu.pulse":"脈衝","microbitMore.pinEventTypeMenu.edge":"邊緣","microbitMore.connectionStateMenu.connected":"連接","microbitMore.connectionStateMenu.disconnected":"斷開","microbitMore.whenConnectionChanged":"當 micro:bit [STATE]","microbitMore.whenButtonEvent":"當按鍵 [NAME] 被 [EVENT]","microbitMore.isButtonPressed":"按鍵 [NAME] 按下?","microbitMore.whenTouchEvent":"當引腳 [NAME] 被 [EVENT]","microbitMore.isPinTouched":"引腳 [NAME] 被觸摸?","microbitMore.whenGesture":"當 [GESTURE] 時","microbitMore.displayMatrix":"顯示圖案 [MATRIX] ","microbitMore.displayText":"顯示文本 [TEXT] 延時 [DELAY] ms","microbitMore.clearDisplay":"清空屏幕","microbitMore.lightLevel":"亮度級別","microbitMore.temperature":"溫度","microbitMore.compassHeading":"指南針面向","microbitMore.pitch":"旋轉","microbitMore.roll":"橫滾","microbitMore.soundLevel":"聲音響度","microbitMore.magneticForce":"磁力","microbitMore.acceleration":"加速度 [AXIS]","microbitMore.analogValue":"引腳 [PIN] 模擬值","microbitMore.setPullMode":"將引腳 [PIN] 輸入模式設為 [MODE]","microbitMore.isPinHigh":"引腳 [PIN] 是高電平?","microbitMore.setDigitalOut":"將引腳 [PIN] 數字值設為 [LEVEL]","microbitMore.setAnalogOut":"將引腳 [PIN] 模擬值設為 [LEVEL] %","microbitMore.setServo":"將引腳 [PIN] 舵機角度設為 [ANGLE]","microbitMore.playTone":"播放 [FREQ] Hz 音頻並將音量設為 [VOL] %","microbitMore.stopTone":"停止音頻","microbitMore.listenPinEventType":"監聽引腳 [PIN] 事件 [EVENT_TYPE]","microbitMore.whenPinEvent":"當引腳 [PIN] 發生 [EVENT] 事件","microbitMore.getPinEventValue":"引腳 [PIN] 的 [EVENT] 值","microbitMore.whenDataReceived":"當從 micro:bit 接收到主題為 [LABEL] 的消息","microbitMore.getDataLabeled":"主題為 [LABEL] 的消息內容","microbitMore.sendData":"廣播主題為 [LABEL] 的消息 [DATA] 給 micro:bit","microbitMore.sendData.label":"標題","microbitMore.sendData.data":"數據"}})}();