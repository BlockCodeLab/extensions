!async function(){await Scratch.require("https://unpkg.com/jsqr@1.4.0/dist/jsQR.js"),await Scratch.require("https://unpkg.com/qrcode-svg-ts@1.4.0/dist/index.min.js");const e=Scratch.formatMessage,t=Scratch.ArgumentType,r=Scratch.BlockType,o=Scratch.Cast,d=Scratch.Clone,a=Scratch.Color,c=[480,360];Scratch.extensions.register(new class n{static get STATE_KEY(){return"Scratch.QRCode"}static get DEFAULT_QRCODE_STATE(){return{skinId:null,content:e({id:"qrcode.defaultQRCodeText",default:"hello!"}),color:a.rgbToHex(a.RGB_BLACK),size:100,visible:!1}}constructor(){this.runtime=Scratch.vm.runtime,this.runtime.on("PROJECT_STOP_ALL",this.stopAll.bind(this)),this.runtime.on("targetWasCreated",this._onTargetCreated.bind(this)),this.runtime.on("targetWasRemoved",this._onTargetWillExit.bind(this))}getInfo(){return{id:"qrcode",dependencies:["videoSensing"],name:e({id:"qrcode.name",default:"QR Code"}),blockIconURI:"data:image/png;base64,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",blocks:[{opcode:"decodeCamera",blockType:r.COMMAND,text:e({id:"qrcode.decodeCamera",default:"scan QR code from camera and wait"})},{opcode:"whenAnyQRcode",blockType:r.HAT,text:e({id:"qrcode.whenAnyQRcode",default:"when QR code is scanned"})},{opcode:"whenQRcode",blockType:r.HAT,text:e({id:"qrcode.whenQRcode",default:"when QR code is [TEXT]"}),arguments:{TEXT:{type:t.STRING,defaultValue:e({id:"qrcode.defaultQRCodeText",default:"hello!"})}}},{opcode:"getQRcode",blockType:r.REPORTER,text:e({id:"qrcode.getQRcode",default:"QR code content"})},"---",{opcode:"generate",blockType:r.COMMAND,text:e({id:"qrcode.generate",default:"generate QR code with [TEXT]"}),arguments:{TEXT:{type:t.STRING,defaultValue:e({id:"qrcode.defaultQRCodeText",default:"hello!"})}}},{opcode:"setColor",blockType:r.COMMAND,text:e({id:"qrcode.setColor",default:"set QR code color to [COLOR]"}),arguments:{COLOR:{type:t.COLOR,defaultValue:n.DEFAULT_QRCODE_STATE.color}}},{opcode:"setSize",blockType:r.COMMAND,text:e({id:"qrcode.setSize",default:"set QR code size to [SIZE]"}),arguments:{SIZE:{type:t.NUMBER,defaultValue:n.DEFAULT_QRCODE_STATE.size}}},{opcode:"clear",blockType:r.COMMAND,text:e({id:"qrcode.clear",default:"clear all QR code"})}]}}_decode(e){this._timer=setTimeout(this._decode.bind(this,e),Math.max(this.runtime.currentStepTime));var t=this.runtime.ioDevices.video.getFrame({format:"image-data",dimensions:c,cacheTimeout:this.runtime.currentStepTime});(t=t&&window.jsQR(t.data,t.width,t.height))&&(this.currentQRValue=""+t.data,clearTimeout(this._timer),e())}_encode(e){return new window.QRCodeSVG({content:e.content,color:e.color,width:e.size,height:e.size,padding:0,background:"transparent",container:"svg"}).svg()}decodeCamera(){return this.runtime.ioDevices.video.enableVideo(),new Promise(t=>{try{this._decode(t)}catch(e){this.currentQRValue="",t()}}).finally(()=>{setTimeout(()=>{this.runtime.ioDevices.video.disableVideo()},1e3)})}getQRcode(){return this.currentQRValue||""}whenAnyQRcode(){return""!==this.currentQRValue}whenQRcode(e){return this.currentQRValue===o.toString(e.TEXT)}clear(e,t){(r=this._getQRCodeState(t.target)).visible=!1,t.target.setCustomState(n.STATE_KEY,r);var r=t.target.getCurrentCostume();this.runtime.renderer.updateDrawableSkinId(t.target.drawableID,r.skinId)}generate(e,t){this.runtime.targets[t.target.id]=t.target;var r=this._getQRCodeState(t.target);r.content=o.toString(e.TEXT),r.visible=!0,this._renderQRCode(t.target)}setColor(e,t){this._getQRCodeState(t.target).color=o.toString(e.COLOR),this._renderQRCode(t.target)}setSize(e,t){this._getQRCodeState(t.target).size=o.toNumber(e.SIZE),this._renderQRCode(t.target)}stopAll(){Object.values(this.runtime.targets).forEach(e=>{this.clear({},{target:e})})}_getQRCodeState(e){let t=e.getCustomState(n.STATE_KEY);return t||(t=d.simple(n.DEFAULT_QRCODE_STATE),e.setCustomState(n.STATE_KEY,t)),t}_renderQRCode(e){var t;this.runtime.renderer&&(t=this._getQRCodeState(e)).visible&&(t.skinId=this._updateSVGSkin(t),this.runtime.renderer.updateDrawableSkinId(e.drawableID,t.skinId))}_updateSVGSkin(e){var t=this._encode(e);return e.skinId?(this.runtime.renderer.updateSVGSkin(e.skinId,t),e.skinId):this.runtime.renderer.createSVGSkin(t)}_onTargetCreated(e,t){if(t=t&&t.getCustomState(n.STATE_KEY)){e.setCustomState(n.STATE_KEY,d.simple(t)),e.getCustomState(n.STATE_KEY).skinId=null;const r=()=>{this._renderQRCode(e),e.off("EVENT_TARGET_VISUAL_CHANGE",r)};e.on("EVENT_TARGET_VISUAL_CHANGE",r)}}_onTargetWillExit(e){(e=this._getQRCodeState(e)).skinId&&(this.runtime.renderer.destroySkin(e.skinId),e.skinId=null)}}),Scratch.extensions.translations({en:{"qrcode.name":"QR Code","qrcode.decodeCamera":"scan QR code from camera and wait","qrcode.whenAnyQRcode":"when QR code is scanned","qrcode.whenQRcode":"when QR code is [TEXT]","qrcode.getQRcode":"QR code content","qrcode.defaultQRCodeText":"hello!","qrcode.clear":"show sprite","qrcode.generate":"generate QR code with [TEXT]","qrcode.setColor":"set QR code color to [COLOR]","qrcode.setSize":"set QR code size to [SIZE]"},"zh-cn":{"qrcode.name":"二维码","qrcode.decodeCamera":"扫描二维码并等待","qrcode.whenAnyQRcode":"当扫描到二维码","qrcode.whenQRcode":"当二维码是 [TEXT]","qrcode.getQRcode":"二维码内容","qrcode.defaultQRCodeText":"你好！","qrcode.clear":"显示角色","qrcode.generate":"生成 [TEXT] 的二维码","qrcode.setColor":"将二维码颜色设为 [COLOR]","qrcode.setSize":"将二维码尺寸设为 [SIZE]"},"zh-tw":{"qrcode.name":"二維碼","qrcode.decodeCamera":"掃描二維碼並等待","qrcode.whenAnyQRcode":"當掃描到二維碼","qrcode.whenQRcode":"當二維碼是 [TEXT]","qrcode.getQRcode":"二維碼內容","qrcode.defaultQRCodeText":"你好！","qrcode.clear":"顯示角色","qrcode.generate":"生成 [TEXT] 的二維碼","qrcode.setColor":"將二維碼顏色設為 [COLOR]","qrcode.setSize":"將二維碼尺寸設為 [SIZE]"}})}();