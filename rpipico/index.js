!async function(t){const i=t.ArgumentType,a=t.BlockType,s=t.Cast,n=t.MathUtil,r=t.formatMessage;var e=await t.require("../repl/repl.js"),l=await t.require("./translations.js");t.extensions.translations(l);const u="[0m\r7> ",o=`\r
[90mundefined[0m\r
`+u;u;const p=/\r\n\x1B\[95m(\d+)\x1B\[0m\r\n\x1B\[0m\r\x1B7> /m,N=t=>new Promise(e=>setTimeout(e,t)),d=e=>!Number.isNaN(Number(e)),h={ON:"on",OFF:"off"},c={NONE:"INPUT",DOWN:"INPUT_PULLDOWN",UP:"INPUT_PULLUP",OUTPUT:"OUTPUT"},E={LOW:"LOW",HIGH:"HIGH"},I={FALLING:"FALLING",RISING:"RISING",CHANGE:"CHANGE"},g={min:0,max:180},P={min:.5,max:2.5};class A extends e{constructor(e,t){super(e,t),this._encoder=new TextEncoder,this._runtime.registerPeripheralExtension(this._extensionId,this),this._files=[],this.state={}}get filters(){return[{usbProductId:10,usbVendorId:11914}]}disconnect(){this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!1),super.disconnect()}async _onConnect(){super._onConnect(),await this.send(".reset"),await N(500),this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!0);try{for(var[e,t]of this._files)await this.put(e,t)}catch(e){this._serial._handleRequestError(e)}finally{this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!1)}}async put(t,i){var e=this._encoder.encode(i),i=`(function (fn,fc){require('fs').writeFile(fn,new TextEncoder().encode(fc))})('${t}', '${i.replaceAll("\\","\\\\").replaceAll("'","\\'").replaceAll("\n","\\n")}');`;try{await this.write("\r.ls\r",`\r
${e.length}	${t}\r
`,500)}catch(e){await this.write(`\r.rm ${t}\r`),await N(500),await this.run(i)}}async run(e){await this.write("\r.flash -w\r"),await N(500),await this.transfer(this._encoder.encode(e)),await N(500),await this.write("\r.load\r",u),this.state={}}async send(e,t=null){return this.write(`\r${e.replaceAll("\n","\\n")}\r`,t)}async _setupLED(){this.state.led="led_"+Date.now().toString(36),await this.send(`const ${this.state.led}=board.led(board.LED)`,o)}async led(e){void 0===this.state.led&&await this._setupLED(),await this.send(this.state.led+`.${e}()`,o)}async toggle(){void 0===this.state.led&&await this._setupLED(),await this.send(this.state.led+".toggle()",o)}async setPinMode(e,t=c.NONE){this.state[e]=t,await this.send(`pinMode(${e},${t})`,o)}async getPinValue(e){return void 0===this.state[e]&&(await this.setPinMode(e,c.NONE),this.state[e]="ANALOG_INPUT"),"ANALOG_INPUT"!==this.state[e]?(delete this.state[e],this.getPinValue(e)):(e=await this.send(`console.log('
~ pin${e}<'+analogRead(${e})+'>')`,/^~ pin\d+<([\d.]+)>$/m),d(e[1])?parseFloat(e[1]):void 0)}async isPinHigh(e){return void 0===this.state[e]&&await this.setPinMode(e,c.NONE),/^INPUT.*/.test(this.state[e])?"1"===(await this.send(`console.log('
~ pin${e}<'+digitalRead(${e})+'>')`,/^~ pin\d+<(\d)>$/m))[1]:(delete this.state[e],this.isPinHigh(e))}async setPinValue(e,t){if(void 0===this.state[e]&&await this.setPinMode(e,c.OUTPUT),this.state[e]!==c.OUTPUT)return delete this.state[e],this.setPinValue(e,t);void 0===t?await this.send(`digitalToggle(${e})`,o):d(t)?await this.send(`analogWrite(${e},${t})`,o):await this.send(`digitalWrite(${e},${t})`,o)}async setServoAngle(e,t){if(void 0===this.state[e]){this.state[e]="pwm_"+Date.now();const a=P.min/20;await this.send(`const ${this.state[e]}=board.pwm(${e},50,${a})`,o),await this.send(this.state[e]+".start();")}if(!this.state[e].includes("pwm_"))return delete this.state[e],this.setServoAngle(e,t);var i=(P.max-P.min)/g.max;const a=(P.min+t*i)/20;await this.send(`${this.state[e]}.setDuty(${a})`,o)}async setupWatcher(t){var e=`console.log('
~ pin_${t}_${I.FALLING}')`,i=`console.log('
~ pin_${t}_${I.RISING}')`,e=await this.send(`setWatch(()=>${e},${t},FALLING,10)`,p),i=await this.send(`setWatch(()=>${i},${t},RISING,10)`,p);(e||i)&&(this.state[t]={id:[e&&e[1],i&&i[1]],value:null},this.on(new RegExp(`^~ pin_(${t})_(${I.FALLING}|${I.RISING})$`,"m"),e=>{this.state[t].value=e[2],setTimeout(()=>this.state[t].value=null,50)}))}async stopWatch(e){if(this.state[e]){for(const t of this.state[e].id)await this.send(`clearWatch(${t})`);delete this.state[e]}}checkPinEvent(e,t){if(this.state[e])return t===I.CHANGE?null!==this.state[e].value:this.state[e].value===t}}t.extensions.register(new class m{static get EXTENSION_ID(){return"rpipico"}static get EXTENSION_NAME(){return r({id:"rpipico.name",default:"RPi Pico"})}get LED_STATE_MENU(){return[{text:r({id:"rpipico.ledStateMenu.on",default:"on"}),value:h.ON},{text:r({id:"rpipico.ledStateMenu.off",default:"off"}),value:h.OFF}]}get PIN_MODE_MENU(){return[{text:r({id:"rpipico.pinModeMenu.none",default:"none"}),value:c.NONE},{text:r({id:"rpipico.pinModeMenu.up",default:"pull up"}),value:c.UP},{text:r({id:"rpipico.pinModeMenu.down",default:"pull down"}),value:c.DOWN}]}get ANALOG_PINS_MENU(){var e=this.pinsMap();return[{text:"GP26",value:""+e[26]},{text:"GP27",value:""+e[27]},{text:"GP28",value:""+e[28]}]}get DIGITAL_PINS_MENU(){return Object.entries(this.pinsMap()).map(([e,t])=>({text:"GP"+e,value:""+t}))}get DIGITAL_VALUE_MENU(){return[{text:r({id:"rpipico.digitalValueMenu.low",default:"low"}),value:E.LOW},{text:r({id:"rpipico.digitalValueMenu.high",default:"high"}),value:E.HIGH}]}get INTERRUPT_EVENTS_MENU(){return[{text:r({id:"rpipico.interruptEventsMenu.falling",default:"falling"}),value:I.FALLING},{text:r({id:"rpipico.interruptEventsMenu.rising",default:"rising"}),value:I.RISING},{text:r({id:"rpipico.interruptEventsMenu.change",default:"change"}),value:I.CHANGE}]}constructor(){this.runtime=t.vm.runtime,this._peripheral=new A(this.runtime,m.EXTENSION_ID),this.runtime.on("PROJECT_STOP_ALL",()=>this.send(".reset","\r\nsoft reset\r\n"))}async put(e){if(this._peripheral.isConnected()){this.runtime.emit("EXTENSION_DATA_DOWNLOADING",!0);try{for(var[t,i]of e)await this._peripheral.put(t,i)}catch(e){this._peripheral._serial._handleRequestError(e)}finally{this.runtime.emit("EXTENSION_DATA_DOWNLOADING",!1)}}else this._peripheral._files=this._peripheral._files.concat(e)}run(e){return this._peripheral.run(e)}send(e,t){return this._peripheral.send(e,t)}pinsMap(){return{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,26:26,27:27,28:28}}getInfo(){var e=r.setup().locale;return this._peripheral.setupAddon(m.EXTENSION_ID,m.EXTENSION_NAME,()=>this._peripheral.send(".hi")),{id:m.EXTENSION_ID,name:m.EXTENSION_NAME,blockIconURI:"data:image/png;base64,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",showStatusButton:!0,docsURI:t.require.resolve(`readme.${e}.html`),blocks:[{opcode:"setLEDState",text:r({id:"rpipico.setLEDState",default:"set LED [STATE]"}),blockType:a.COMMAND,arguments:{STATE:{type:i.STRING,menu:"ledState",defaultValue:h.ON}}},{opcode:"toggleLED",text:r({id:"rpipico.toggleLEDState",default:"toggle LED"}),blockType:a.COMMAND},"---",{opcode:"analogValue",text:r({id:"rpipico.analogValue",default:"analog value of pin [PIN]"}),blockType:a.REPORTER,arguments:{PIN:{type:i.NUMBER,menu:"analogPins",defaultValue:this.ANALOG_PINS_MENU[0].value}}},{opcode:"setPullMode",text:r({id:"rpipico.setPullMode",default:"set pin [PIN] to input [MODE]"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},MODE:{type:i.STRING,menu:"pinModes",defaultValue:c.NONE}}},{opcode:"isPinHigh",text:r({id:"rpipico.isPinHigh",default:"[PIN] pin is high?"}),blockType:a.BOOLEAN,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},"---",{opcode:"setAnalogValue",text:r({id:"rpipico.setAnalogValue",default:"set pin [PIN] analog [VALUE] %"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"analogPins",defaultValue:this.ANALOG_PINS_MENU[0].value},VALUE:{type:i.NUMBER,defaultValue:0}}},{opcode:"setDigitalValue",text:r({id:"rpipico.setDigitalValue",default:"set pin [PIN] digital [VALUE]"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},VALUE:{type:i.STRING,menu:"digitalValues",defaultValue:E.LOW}}},{opcode:"toggleDigitalValue",text:r({id:"rpipico.toggleDigitalValue",default:"toggle pin [PIN] digital"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"setServoAngle",text:r({id:"rpipico.setServoAngle",default:"set pin [PIN] servo angle [ANGLE]"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},ANGLE:{type:i.NUMBER,defaultValue:90}}},"---",{opcode:"listenEvent",text:r({id:"rpipico.listenEvent",default:"listen event on [PIN]"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"whenCatchEvent",text:r({id:"rpipico.whenCatchEvent",default:"when catch [EVENT] at pin [PIN]"}),blockType:a.HAT,arguments:{EVENT:{type:i.STRING,menu:"interruptEvents",defaultValue:this.INTERRUPT_EVENTS_MENU[0].value},PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"isCatchEvent",text:r({id:"rpipico.isCatchEvent",default:"catch [EVENT] at pin [PIN]"}),blockType:a.BOOLEAN,arguments:{EVENT:{type:i.STRING,menu:"interruptEvents",defaultValue:this.INTERRUPT_EVENTS_MENU[0].value},PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"stopListen",text:r({id:"rpipico.stopListen",default:"stop listen on [PIN]"}),blockType:a.COMMAND,arguments:{PIN:{type:i.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}}],menus:{ledState:{acceptReporters:!1,items:this.LED_STATE_MENU},analogPins:{acceptReporters:!1,items:this.ANALOG_PINS_MENU},digitalPins:{acceptReporters:!1,items:this.DIGITAL_PINS_MENU},pinModes:{acceptReporters:!1,items:this.PIN_MODE_MENU},digitalValues:{acceptReporters:!0,items:this.DIGITAL_VALUE_MENU},interruptEvents:{acceptReporters:!1,items:this.INTERRUPT_EVENTS_MENU}}}}async setLEDState(e){e=s.toString(e.STATE),await this._peripheral.led(e)}async toggleLED(){await this._peripheral.toggle()}async analogValue(e){return e=s.toNumber(e.PIN),this._peripheral.getPinValue(e)}async setPullMode(e){var t=s.toNumber(e.PIN),e=s.toString(e.MODE);await this._peripheral.setPinMode(t,e)}async isPinHigh(e){return e=s.toNumber(e.PIN),this._peripheral.isPinHigh(e)}async setDigitalValue(e){var t=s.toNumber(e.PIN),e=s.toString(e.VALUE);await this._peripheral.setPinValue(t,e)}async toggleDigitalValue(e){e=s.toNumber(e.PIN),await this._peripheral.setPinValue(e)}async setAnalogValue(e){var t=s.toNumber(e.PIN),e=s.toNumber(e.VALUE)/100;await this._peripheral.setPinValue(t,e)}async setServoAngle(e){var t=s.toNumber(e.PIN),e=s.toNumber(e.ANGLE),e=n.clamp(e,g.min,g.max);await this._peripheral.setServoAngle(t,e)}async listenEvent(e){e=s.toNumber(e.PIN),await this._peripheral.setupWatcher(e)}whenCatchEvent(e){return this.isCatchEvent(e)}isCatchEvent(e){var t=s.toNumber(e.PIN),e=s.toString(e.EVENT);return this._peripheral.checkPinEvent(t,e)}async stopListen(e){e=s.toNumber(e.PIN),await this._peripheral.stopWatch(e)}})}(window.Scratch);