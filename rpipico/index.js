!async function(t,e){var i=await e("../repl/repl.js"),a=await e("./translations.json");const s=t.ArgumentType,n=t.BlockType,l=t.Cast,r=t.MathUtil,u=t.formatMessage,o="[0m\r7> ",p=`\r
[90mundefined[0m\r
`+o;o;const N=/\r\n\x1B\[95m(\d+)\x1B\[0m\r\n\x1B\[0m\r\x1B7> /m,h=e=>new Promise(t=>setTimeout(t,e)),d=t=>!Number.isNaN(Number(t)),c={ON:"on",OFF:"off"},E={NONE:"INPUT",DOWN:"INPUT_PULLDOWN",UP:"INPUT_PULLUP",OUTPUT:"OUTPUT"},I={LOW:"LOW",HIGH:"HIGH"},g={LOW_LEVEL:"LOW_LEVEL",HIGH_LEVEL:"HIGH_LEVEL",FALLING:"FALLING",RISING:"RISING",CHANGE:"CHANGE"},A={min:0,max:180},P={min:.5,max:2.5};class m extends i{constructor(t,e){super(t,e),this._encoder=new TextEncoder,this._runtime.registerPeripheralExtension(this._extensionId,this),this._files=[],this.state={}}get filters(){return[{usbProductId:10,usbVendorId:11914}]}disconnect(){this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!1),super.disconnect()}async _onConnect(){super._onConnect(),await this.send(".reset"),await h(500),this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!0);try{for(var[t,e]of this._files)await this.put(t,e)}catch(t){this._serial._handleRequestError(t)}finally{this._runtime.emit("EXTENSION_DATA_DOWNLOADING",!1)}}async put(e,i){var t=this._encoder.encode(i),i=`(function (fn,fc){require('fs').writeFile(fn,new TextEncoder().encode(fc))})('${e}', '${i.replaceAll("\\","\\\\").replaceAll("'","\\'").replaceAll("\n","\\n")}');`;try{await this.write("\r.ls\r",`\r
${t.length}	${e}\r
`,500)}catch(t){await this.write(`\r.rm ${e}\r`),await h(500),await this.run(i)}}async run(t){await this.write("\r.flash -w\r"),await h(500),await this.transfer(this._encoder.encode(t)),await h(500),await this.write("\r.load\r",o),this.state={}}async send(t,e=null){return this.write(`\r${t.replaceAll("\n","\\n")}\r`,e)}async _setupLED(){this.state.led="led_"+Date.now().toString(36),await this.send(`const ${this.state.led}=board.led(board.LED)`,p)}async led(t){void 0===this.state.led&&await this._setupLED(),await this.send(this.state.led+`.${t}()`,p)}async toggle(){void 0===this.state.led&&await this._setupLED(),await this.send(this.state.led+".toggle()",p)}async setPinMode(t,e=E.NONE){this.state[t]=e,await this.send(`pinMode(${t},${e})`,p)}async getPinValue(t){return void 0===this.state[t]&&(await this.setPinMode(t,E.NONE),this.state[t]="ANALOG_INPUT"),"ANALOG_INPUT"!==this.state[t]?(delete this.state[t],this.getPinValue(t)):(t=await this.send(`console.log('
~ pin${t}<'+analogRead(${t})+'>')`,/^~ pin\d+<([\d.]+)>$/m),d(t[1])?parseFloat(t[1]):void 0)}async isPinHigh(t){return void 0===this.state[t]&&await this.setPinMode(t,E.NONE),/^INPUT.*/.test(this.state[t])?"1"===(await this.send(`console.log('
~ pin${t}<'+digitalRead(${t})+'>')`,/^~ pin\d+<(\d)>$/m))[1]:(delete this.state[t],this.isPinHigh(t))}async setPinValue(t,e){if(void 0===this.state[t]&&await this.setPinMode(t,E.OUTPUT),this.state[t]!==E.OUTPUT)return delete this.state[t],this.setPinValue(t,e);void 0===e?await this.send(`digitalToggle(${t})`,p):d(e)?await this.send(`analogWrite(${t},${e})`,p):await this.send(`digitalWrite(${t},${e})`,p)}async setServoAngle(t,e){if(void 0===this.state[t]){this.state[t]="pwm_"+Date.now();const a=P.min/20;await this.send(`const ${this.state[t]}=board.pwm(${t},50,${a})`,p),await this.send(this.state[t]+".start();")}if(!this.state[t].includes("pwm_"))return delete this.state[t],this.setServoAngle(t,e);var i=(P.max-P.min)/A.max;const a=(P.min+e*i)/20;await this.send(`${this.state[t]}.setDuty(${a})`,p)}async setupWatcher(e){var t=`console.log('
~ pin_${e}_${g.FALLING}')`,i=`console.log('
~ pin_${e}_${g.RISING}')`,t=await this.send(`setWatch(()=>${t},${e},FALLING,10)`,N),i=await this.send(`setWatch(()=>${i},${e},RISING,10)`,N);(t||i)&&(this.state[e]={mode:this.state[e]||E.NONE,id:[t&&t[1],i&&i[1]],value:null},this.on(new RegExp(`^~ pin_(${e})_(${g.FALLING}|${g.RISING})$`,"m"),t=>{this.state[e].value=t[2],setTimeout(()=>{this.state[e].value===g.FALLING?this.state[e].value=g.LOW_LEVEL:this.state[e].value===g.RISING?this.state[e].value=g.HIGH_LEVEL:this.state[e].value=null},50)}))}async stopWatch(t){if(this.state[t]){for(const e of this.state[t].id)await this.send(`clearWatch(${e})`);delete this.state[t]}}checkPinEvent(t,e){if(this.state[t])return e===g.CHANGE?this.state[t].value===g.FALLING||this.state[t].value===g.RISING:this.state[t].value===e}}t.extensions.register(new class v{static get EXTENSION_ID(){return"rpipico"}static get EXTENSION_NAME(){return u({id:"rpipico.name",default:"RPi Pico"})}get LED_STATE_MENU(){return[{text:u({id:"rpipico.ledStateMenu.on",default:"on"}),value:c.ON},{text:u({id:"rpipico.ledStateMenu.off",default:"off"}),value:c.OFF}]}get PIN_MODE_MENU(){return[{text:u({id:"rpipico.pinModeMenu.none",default:"none"}),value:E.NONE},{text:u({id:"rpipico.pinModeMenu.up",default:"pull up"}),value:E.UP},{text:u({id:"rpipico.pinModeMenu.down",default:"pull down"}),value:E.DOWN}]}get ANALOG_PINS_MENU(){var t=this.pinsMap();return[{text:"GP26",value:""+t[26]},{text:"GP27",value:""+t[27]},{text:"GP28",value:""+t[28]}]}get DIGITAL_PINS_MENU(){return Object.entries(this.pinsMap()).map(([t,e])=>({text:"GP"+t,value:""+e}))}get DIGITAL_VALUE_MENU(){return[{text:u({id:"rpipico.digitalValueMenu.low",default:"low"}),value:I.LOW},{text:u({id:"rpipico.digitalValueMenu.high",default:"high"}),value:I.HIGH}]}get INTERRUPT_EVENTS_MENU(){return[{text:u({id:"rpipico.interruptEventsMenu.falling",default:"falling"}),value:g.FALLING},{text:u({id:"rpipico.interruptEventsMenu.rising",default:"rising"}),value:g.RISING},{text:u({id:"rpipico.digitalValueMenu.low",default:"low"}),value:g.LOW_LEVEL},{text:u({id:"rpipico.digitalValueMenu.high",default:"high"}),value:g.HIGH_LEVEL},{text:u({id:"rpipico.interruptEventsMenu.change",default:"change"}),value:g.CHANGE}]}constructor(){this.runtime=t.vm.runtime,this._peripheral=new m(this.runtime,v.EXTENSION_ID),this.runtime.on("PROJECT_STOP_ALL",()=>this.send(".reset","\r\nsoft reset\r\n"))}async put(t){if(this._peripheral.isConnected()){this.runtime.emit("EXTENSION_DATA_DOWNLOADING",!0);try{for(var[e,i]of t)await this._peripheral.put(e,i)}catch(t){this._peripheral._serial._handleRequestError(t)}finally{this.runtime.emit("EXTENSION_DATA_DOWNLOADING",!1)}}else this._peripheral._files=this._peripheral._files.concat(t)}run(t){return this._peripheral.run(t)}send(t,e){return this._peripheral.send(t,e)}pinsMap(){return{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,26:26,27:27,28:28}}getInfo(){var t=u.setup().locale;return this._peripheral.setupAddon(v.EXTENSION_ID,v.EXTENSION_NAME,()=>this._peripheral.send(".hi")),{id:v.EXTENSION_ID,name:v.EXTENSION_NAME,blockIconURI:"data:image/png;base64,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",showStatusButton:!0,docsURI:e.resolve(`readme.${t}.html`),blocks:[{opcode:"setLEDState",text:u({id:"rpipico.setLEDState",default:"set LED [STATE]"}),blockType:n.COMMAND,arguments:{STATE:{type:s.STRING,menu:"ledState",defaultValue:c.ON}}},{opcode:"toggleLED",text:u({id:"rpipico.toggleLEDState",default:"toggle LED"}),blockType:n.COMMAND},"---",{opcode:"analogValue",text:u({id:"rpipico.analogValue",default:"analog value of pin [PIN]"}),blockType:n.REPORTER,arguments:{PIN:{type:s.NUMBER,menu:"analogPins",defaultValue:this.ANALOG_PINS_MENU[0].value}}},{opcode:"setPullMode",text:u({id:"rpipico.setPullMode",default:"set pin [PIN] to input [MODE]"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},MODE:{type:s.STRING,menu:"pinModes",defaultValue:E.NONE}}},{opcode:"isPinHigh",text:u({id:"rpipico.isPinHigh",default:"[PIN] pin is high?"}),blockType:n.BOOLEAN,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},"---",{opcode:"setAnalogValue",text:u({id:"rpipico.setAnalogValue",default:"set pin [PIN] analog [VALUE] %"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"analogPins",defaultValue:this.ANALOG_PINS_MENU[0].value},VALUE:{type:s.NUMBER,defaultValue:0}}},{opcode:"setDigitalValue",text:u({id:"rpipico.setDigitalValue",default:"set pin [PIN] digital [VALUE]"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},VALUE:{type:s.STRING,menu:"digitalValues",defaultValue:I.LOW}}},{opcode:"toggleDigitalValue",text:u({id:"rpipico.toggleDigitalValue",default:"toggle pin [PIN] digital"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"setServoAngle",text:u({id:"rpipico.setServoAngle",default:"set pin [PIN] servo angle [ANGLE]"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value},ANGLE:{type:s.NUMBER,defaultValue:90}}},"---",{opcode:"listenEvent",text:u({id:"rpipico.listenEvent",default:"listen event on [PIN]"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"whenCatchEvent",text:u({id:"rpipico.whenCatchEvent",default:"when catch [EVENT] at pin [PIN]"}),blockType:n.HAT,arguments:{EVENT:{type:s.STRING,menu:"interruptEvents",defaultValue:this.INTERRUPT_EVENTS_MENU[0].value},PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"isCatchEvent",text:u({id:"rpipico.isCatchEvent",default:"catch [EVENT] at pin [PIN]"}),blockType:n.BOOLEAN,arguments:{EVENT:{type:s.STRING,menu:"interruptEvents",defaultValue:this.INTERRUPT_EVENTS_MENU[0].value},PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}},{opcode:"stopListen",text:u({id:"rpipico.stopListen",default:"stop listen on [PIN]"}),blockType:n.COMMAND,arguments:{PIN:{type:s.NUMBER,menu:"digitalPins",defaultValue:this.DIGITAL_PINS_MENU[0].value}}}],menus:{ledState:{acceptReporters:!1,items:this.LED_STATE_MENU},analogPins:{acceptReporters:!1,items:this.ANALOG_PINS_MENU},digitalPins:{acceptReporters:!1,items:this.DIGITAL_PINS_MENU},pinModes:{acceptReporters:!1,items:this.PIN_MODE_MENU},digitalValues:{acceptReporters:!0,items:this.DIGITAL_VALUE_MENU},interruptEvents:{acceptReporters:!1,items:this.INTERRUPT_EVENTS_MENU}}}}async setLEDState(t){t=l.toString(t.STATE),await this._peripheral.led(t)}async toggleLED(){await this._peripheral.toggle()}async analogValue(t){return t=l.toNumber(t.PIN),this._peripheral.getPinValue(t)}async setPullMode(t){var e=l.toNumber(t.PIN),t=l.toString(t.MODE);await this._peripheral.setPinMode(e,t)}async isPinHigh(t){return t=l.toNumber(t.PIN),this._peripheral.isPinHigh(t)}async setDigitalValue(t){var e=l.toNumber(t.PIN),t=l.toString(t.VALUE);await this._peripheral.setPinValue(e,t)}async toggleDigitalValue(t){t=l.toNumber(t.PIN),await this._peripheral.setPinValue(t)}async setAnalogValue(t){var e=l.toNumber(t.PIN),t=l.toNumber(t.VALUE)/100;await this._peripheral.setPinValue(e,t)}async setServoAngle(t){var e=l.toNumber(t.PIN),t=l.toNumber(t.ANGLE),t=r.clamp(t,A.min,A.max);await this._peripheral.setServoAngle(e,t)}async listenEvent(t){t=l.toNumber(t.PIN),await this._peripheral.setupWatcher(t)}whenCatchEvent(t){return this.isCatchEvent(t)}isCatchEvent(t){var e=l.toNumber(t.PIN),t=l.toString(t.EVENT);return this._peripheral.checkPinEvent(e,t)}async stopListen(t){t=l.toNumber(t.PIN),await this._peripheral.stopWatch(t)}}),t.extensions.translations(a)}(Scratch,require);