Scratch.export({"st7789.js":'(function(){const graphics=require("graphics");const MADCTL_ROW_ORDER=0b10000000;const MADCTL_COL_ORDER=0b01000000;const MADCTL_SWAP_XY=0b00100000;const MADCTL_SCAN_ORDER=0b00010000;const MADCTL_RGB=0b00001000;const MADCTL_HORIZ_ORDER=0b00000100;class ST7789{setup(spi,options){this.spi=spi;options=Object.assign({width:240,height:240,dc:-1,rst:-1,cs:-1,bl:-1,rotation:0,},options);this.width=options.width;this.height=options.height;this.dc=options.dc;this.rst=options.rst;this.cs=options.cs;this.bl=options.bl;this.rotation=options.rotation;this.xstart=0;this.ystart=0;this.context=null;if(this.dc>-1)pinMode(this.dc,OUTPUT);if(this.cs>-1)pinMode(this.cs,OUTPUT);if(this.bl>-1)pinMode(this.bl,OUTPUT);if(this.rst>-1){pinMode(this.rst,OUTPUT);digitalWrite(this.rst,LOW);delay(100);digitalWrite(this.rst,HIGH)}\nthis.init()}\non(){digitalWrite(this.bl,HIGH)}\noff(){digitalWrite(this.bl,LOW)}\ninit(){this.cmd(0x01);delay(150);this.cmd(0x35,[0x00]);this.cmd(0x3a,[0x05]);this.cmd(0x36,[0x04]);this.cmd(0xB2,[0x0C,0x0C,0x00,0x33,0x33]);this.cmd(0x26,[0x01]);this.cmd(0xB7,[0x14]);this.cmd(0xBB,[0x25]);this.cmd(0xC0,[0x2C]);this.cmd(0xC2,[0x01]);this.cmd(0xC3,[0x12]);this.cmd(0xC4,[0x20]);this.cmd(0xD0,[0xA4,0xA1]);this.cmd(0xC6,[0x1E]);this.cmd(0xE0,[0xD0,0x04,0x0D,0x11,0x13,0x2B,0x3F,0x54,0x4C,0x18,0x0D,0x0B,0x1F,0x23]);this.cmd(0xE1,[0xD0,0x04,0x0C,0x11,0x13,0x2C,0x3F,0x44,0x51,0x2F,0x1F,0x1F,0x20,0x23]);this.cmd(0x21);this.cmd(0x11);this.cmd(0x29);delay(100);let madctl=0;let c0=0,c1=0;let r0=0,r1=0;if(this.width===240&&this.height===240){madctl=MADCTL_HORIZ_ORDER}\nif(this.width===240&&this.height===135){madctl=MADCTL_COL_ORDER|MADCTL_SWAP_XY|MADCTL_SCAN_ORDER;c0=40;r0=53}\nif(this.width===135&&this.height===240){c0=52;r0=40}\nif(this.width===320&&this.height===240){c0=0;r0=40;madctl=0x70}\nc1=c0+this.width-1;r1=r0+this.height-1;this.xstart=c0;this.ystart=r0;this.cmd(0x2a,[c0>>8,c0&0xff,c1>>8,c1&0xff]);this.cmd(0x2a,[r0>>8,r0&0xff,r1>>8,r1&0xff]);this.cmd(0x36,[madctl])}\ncmd(cmd,data,count=1){digitalWrite(this.cs,LOW);digitalWrite(this.dc,LOW);this.spi.send(new Uint8Array([cmd]));digitalWrite(this.dc,HIGH);if(data)this.spi.send(new Uint8Array(data),5000,count);digitalWrite(this.cs,HIGH)}\ngetContext(type="direct"){if(!this.context){if(type==="buffer"){this.context=new graphics.BufferedGraphicsContext(this.width,this.height,{rotation:this.rotation,bpp:16,display:(buffer)=>{const xa=this.xstart+this.width-1;const ya=this.ystart+this.height-1;this.cmd(0x2a,[0,this.xstart,xa>>8,xa&0xff]);this.cmd(0x2b,[0,this.ystart,ya>>8,ya&0xff]);digitalWrite(this.cs,LOW);digitalWrite(this.dc,LOW);this.spi.send(new Uint8Array([0x2c]));digitalWrite(this.dc,HIGH);this.spi.send(buffer);digitalWrite(this.cs,HIGH)},})}else{this.context=new graphics.GraphicsContext(this.width,this.height,{rotation:this.rotation,setPixel:(x,y,c)=>{const x0=this.xstart+x;const y0=this.ystart+y;this.cmd(0x2a,[x0>>8,x0&0xff,x0>>8,x0&0xff]);this.cmd(0x2b,[y0>>8,y0&0xff,y0>>8,y0&0xff]);this.cmd(0x2c,[c>>8,c])},fillRect:(x,y,w,h,c)=>{const x1=this.xstart+x;const x2=this.xstart+x+w-1;const y1=this.ystart+y;const y2=this.ystart+y+h-1;this.cmd(0x2a,[x1>>8,x1&0xff,x2>>8,x2&0xff]);this.cmd(0x2b,[y1>>8,y1&0xff,y2>>8,y2&0xff]);this.cmd(0x2c,[c>>8,c],w*h)},})}}\nreturn this.context}}\nreturn ST7789})()'});