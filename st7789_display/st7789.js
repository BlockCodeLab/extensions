const graphics=require("graphics"),MADCTL_ROW_ORDER=128,MADCTL_COL_ORDER=64,MADCTL_SWAP_XY=32,MADCTL_SCAN_ORDER=16,MADCTL_RGB=8,MADCTL_HORIZ_ORDER=4;class ST7789{constructor(t,i){this.spi=t,i=Object.assign({width:240,height:240,dc:-1,rst:-1,cs:-1,bl:-1,rotation:0},i),this.width=i.width,this.height=i.height,this.dc=i.dc,this.rst=i.rst,this.cs=i.cs,this.bl=i.bl,this.rotation=i.rotation,this.xstart=0,this.ystart=0,this.context=null,-1<this.dc&&pinMode(this.dc,OUTPUT),-1<this.cs&&pinMode(this.cs,OUTPUT),-1<this.bl&&pinMode(this.bl,OUTPUT),-1<this.rst&&(pinMode(this.rst,OUTPUT),digitalWrite(this.rst,LOW),delay(100),digitalWrite(this.rst,HIGH)),this.init()}on(){digitalWrite(this.bl,HIGH)}off(){digitalWrite(this.bl,LOW)}init(){this.cmd(1),delay(150),this.cmd(53,[0]),this.cmd(58,[5]),this.cmd(54,[4]),this.cmd(178,[12,12,0,51,51]),this.cmd(38,[1]),this.cmd(183,[20]),this.cmd(187,[37]),this.cmd(192,[44]),this.cmd(194,[1]),this.cmd(195,[18]),this.cmd(196,[32]),this.cmd(208,[164,161]),this.cmd(198,[30]),this.cmd(224,[208,4,13,17,19,43,63,84,76,24,13,11,31,35]),this.cmd(225,[208,4,12,17,19,44,63,68,81,47,31,31,32,35]),this.cmd(33),this.cmd(17),this.cmd(41),delay(100);let t=0,i=0,s,h=0,d;240===this.width&&240===this.height&&(t=MADCTL_HORIZ_ORDER),240===this.width&&135===this.height&&(t=MADCTL_COL_ORDER|MADCTL_SWAP_XY|MADCTL_SCAN_ORDER,i=40,h=53),135===this.width&&240===this.height&&(i=52,h=40),320===this.width&&240===this.height&&(i=0,h=40,t=112),s=i+this.width-1,d=h+this.height-1,this.xstart=i,this.ystart=h,this.cmd(42,[i>>8,255&i,s>>8,255&s]),this.cmd(42,[h>>8,255&h,d>>8,255&d]),this.cmd(54,[t])}cmd(t,i,s=1){digitalWrite(this.cs,LOW),digitalWrite(this.dc,LOW),this.spi.send(new Uint8Array([t])),digitalWrite(this.dc,HIGH),i&&this.spi.send(new Uint8Array(i),5e3,s),digitalWrite(this.cs,HIGH)}getContext(t){return this.context||(this.context="buffer"===t?new graphics.BufferedGraphicsContext(this.width,this.height,{rotation:this.rotation,bpp:16,display:t=>{var i=this.xstart+this.width-1,s=this.ystart+this.height-1;this.cmd(42,[0,this.xstart,i>>8,255&i]),this.cmd(43,[0,this.ystart,s>>8,255&s]),digitalWrite(this.cs,LOW),digitalWrite(this.dc,LOW),this.spi.send(new Uint8Array([44])),digitalWrite(this.dc,HIGH),this.spi.send(t),digitalWrite(this.cs,HIGH)}}):new graphics.GraphicsContext(this.width,this.height,{rotation:this.rotation,setPixel:(t,i,s)=>{t=this.xstart+t,i=this.ystart+i;this.cmd(42,[t>>8,255&t,t>>8,255&t]),this.cmd(43,[i>>8,255&i,i>>8,255&i]),this.cmd(44,[s>>8,s])},fillRect:(t,i,s,h,d)=>{var c=this.xstart+t,t=this.xstart+t+s-1,r=this.ystart+i,i=this.ystart+i+h-1;this.cmd(42,[c>>8,255&c,t>>8,255&t]),this.cmd(43,[r>>8,255&r,i>>8,255&i]),this.cmd(44,[d>>8,d],s*h)}})),this.context}}exports.ST7789=ST7789;