!async function(t,e,s){await e("https://unpkg.com/twgl.js@5.3.1/dist/5.x/twgl.js");e=t.vm.runtime.renderer,t=e.createTextSkin("say","",!0),e=e._allSkins[t].constructor;class i extends e{constructor(t,e){super(t,e),this.style={}}dispose(){this.textWrapper=null,this.measurementProvider=null,super.dispose()}get size(){return this._textDirty&&this._reflowLines(this._renderedScale),this._size}get maxScale(){return 10}setTextAndStyle(t){this._text=t.text,this.style.FONT=t.font,this.style.COLOR=t.color,this.style.MAX_LINE_WIDTH=t.maxWidth,this.style.FONT_SIZE=t.size,this.style.LINE_HEIGHT=t.size+t.size/7,this.style.ALIGN=t.align,this.style.STROKE_WIDTH=t.strokeWidth,this.style.STROKE_COLOR=t.strokeColor,this.style.VERTICAL_PADDING=t.size/7,this.style.RAINBOW=t.rainbow,this.measurementProvider._font=this.style.FONT,this.measurementProvider._fontSize=this.style.FONT_SIZE,this.measurementProvider._ctx.font="".concat(this.style.FONT_SIZE,"px ").concat(this.style.FONT,", serif"),this._textDirty=!0,this._textureDirty=!0,this.emit("WasAltered")}_restyleCanvas(){this.style&&this.style.FONT_SIZE&&(this._canvas.getContext("2d").font="".concat(this.style.FONT_SIZE,"px ").concat(this.style.FONT,", sans-serif"))}_reflowLines(t){var e=this.style.MAX_LINE_WIDTH;e*=this._renderer.gl.canvas.width/this._renderer.getNativeSize()[0],this._lines=this.textWrapper.wrapText(e/=t||1,this._text,this.style.FONT_SIZE,this.style.FONT),this._size[0]=e,this._size[1]=this.style.LINE_HEIGHT*this._lines.length+2*this.style.VERTICAL_PADDING,0<this.style.STROKE_WIDTH&&(this._size[0]+=2*this.style.STROKE_WIDTH,this._size[1]+=2*this.style.STROKE_WIDTH),this._textDirty=!1}_renderText(t){var i=this._canvas.getContext("2d"),h=(this._textDirty&&this._reflowLines(t),this._canvas.width=Math.ceil(this._size[0]*t),this._canvas.height=Math.ceil(this._size[1]*t),this._restyleCanvas(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,this._canvas.width,this._canvas.height),i.scale(t,t),i.stroke(),i.fill(),i.fillStyle=this.style.COLOR,i.font="".concat(this.style.FONT_SIZE,"px ").concat(this.style.FONT,", sans-serif"),this._lines);for(let s=0;s<h.length;s++){var r=h[s],l=this.measurementProvider.measureText(r);let t=0,e=("center"===this.style.ALIGN&&(t=this._size[0]/2-l/2),"right"===this.style.ALIGN&&(t=this._size[0]-l),this.style.LINE_HEIGHT*s+.9*this.style.FONT_SIZE+this.style.VERTICAL_PADDING);if(0<this.style.STROKE_WIDTH&&(e+=this.style.STROKE_WIDTH,i.lineWidth=2*this.style.STROKE_WIDTH,i.strokeStyle=this.style.STROKE_COLOR,i.strokeText(r,t,e)),this.style.RAINBOW){for(var a=i.createLinearGradient(t,0,t+l,0),_=0;_<12;_++)a.addColorStop(_/12,"hsl(".concat(360*_/12,", 100%, 50%)"));i.fillStyle=a}i.fillText(r,t,e)}var e=[this._size[0]/2,.9*this.style.FONT_SIZE];this._rotationCenter=e,this._renderedScale=t}getTexture(t){t=(t?Math.max(Math.abs(t[0]),Math.abs(t[1])):100)/100;if(this._textureDirty||this._renderedScale!==t){if(this._renderedScale!==t&&(this._textDirty=!0),this._renderText(t),0===this._canvas.width||0===this._canvas.height)return this._emptyImageTexture;this._textureDirty=!1;var e,t=this._canvas.getContext("2d").getImageData(0,0,this._canvas.width,this._canvas.height),s=this._renderer.gl;null===this._texture&&(e={auto:!1,wrap:s.CLAMP_TO_EDGE},this._texture=window.twgl.createTexture(s,e)),this._setTexture(t)}return this._texture}}s.TextCostumeSkin=i}(Scratch,require,exports);